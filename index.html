<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <title>Legacy CRM - Enterprise 360 (v6.0 Premium) - Autenticado</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>


    <style>
        :root {
            /* Cores Globais */
            --primary-color: #2563eb;
            --primary-dark: #1e40af;
            --primary-light: #60a5fa;
            --accent-glow: rgba(37, 99, 235, 0.5);
            --secondary-color: #64748b;
            --bg-body: #f8fafc;
            --bg-panel: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --border-radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-hover: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --wa-green: #00a884;
            --wa-bg: #efeae2;
            --wa-sidebar: #ffffff;
            --wa-header: #f0f2f5;
            
            /* Vars Quote Builder */
            --paper-width: 210mm;
            --paper-height: 297mm;
            --quote-accent: #2563eb;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            display: flex;
        }

        /* ==========================================================================
           TELA DE LOGIN SUPABASE (NOVO)
           ========================================================================== */
        #supabase-login-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
            z-index: 10000; /* Acima da Intro 3D */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .login-card {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            width: 100%;
            max-width: 400px;
            text-align: center;
            animation: slideUpLogin 0.5s ease;
        }

        @keyframes slideUpLogin { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .login-logo {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .login-title { font-size: 1.5rem; font-weight: 700; color: #1e293b; margin-bottom: 5px; }
        .login-subtitle { color: #64748b; font-size: 0.9rem; margin-bottom: 30px; }

        .login-form-group { margin-bottom: 15px; text-align: left; }
        .login-form-group label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.85rem; color: #475569; }
        .login-input { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; outline: none; transition: 0.3s; }
        .login-input:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }

        .btn-login {
            width: 100%; padding: 12px; background: var(--primary-color); color: white; border: none; border-radius: 8px;
            font-weight: 600; cursor: pointer; transition: 0.3s; margin-top: 10px;
        }
        .btn-login:hover { background: var(--primary-dark); }
        .btn-login:disabled { background: #94a3b8; cursor: not-allowed; }

        .login-error {
            color: #ef4444; font-size: 0.85rem; margin-top: 15px; display: none; background: #fef2f2; padding: 10px; border-radius: 6px; border: 1px solid #fecaca;
        }

        /* Ocultar elementos do sistema enquanto não logado */
        body.not-authenticated aside,
        body.not-authenticated main,
        body.not-authenticated #mobile-menu-trigger,
        body.not-authenticated #mobile-tab-bar,
        body.not-authenticated #intro-screen {
            display: none !important;
        }
        
        /* Ocultar login quando autenticado */
        body.authenticated #supabase-login-overlay {
            display: none !important;
        }

        /* ==========================================================================
           NOVA INTRODUÇÃO 3D PREMIUM ENTERPRISE
           ========================================================================== */
        #intro-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            perspective: 1200px; /* Profundidade 3D */
            overflow: hidden;
            animation: introExit 0.8s ease-in-out 3s forwards; /* Duração ajustada para 3s */
            pointer-events: none;
        }
        
        @keyframes introExit {
            0% { opacity: 1; transform: scale(1); filter: blur(0); }
            100% { opacity: 0; transform: scale(1.1); filter: blur(10px); visibility: hidden; }
        }

        /* Cubo 3D Central */
        .intro-3d-wrapper {
            position: relative;
            width: 100px;
            height: 100px;
            transform-style: preserve-3d;
            animation: floatCube 4s ease-in-out infinite;
            margin-bottom: 40px;
        }

        .cube {
            width: 100%;
            height: 100%;
            position: absolute;
            transform-style: preserve-3d;
            animation: rotateCube 10s infinite linear;
        }

        .cube-face {
            position: absolute;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 20px var(--accent-glow);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: var(--primary-light);
            font-weight: bold;
        }

        .face-front  { transform: rotateY(0deg) translateZ(50px); }
        .face-back   { transform: rotateY(180deg) translateZ(50px); }
        .face-right  { transform: rotateY(90deg) translateZ(50px); }
        .face-left   { transform: rotateY(-90deg) translateZ(50px); }
        .face-top    { transform: rotateX(90deg) translateZ(50px); }
        .face-bottom { transform: rotateX(-90deg) translateZ(50px); }

        /* Partículas de Fundo */
        .particles {
            position: absolute;
            width: 100%; height: 100%;
            top: 0; left: 0;
            z-index: -1;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(37, 99, 235, 0.1) 0%, transparent 10%),
                radial-gradient(circle at 80% 70%, rgba(37, 99, 235, 0.1) 0%, transparent 10%);
            animation: pulseBg 5s ease infinite alternate;
        }

        /* Texto e Loader */
        .intro-content {
            text-align: center;
            z-index: 10;
            position: relative;
        }

        .intro-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: white;
            margin-bottom: 5px;
            letter-spacing: -1px;
            background: linear-gradient(to right, #ffffff, #94a3b8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            opacity: 0;
            animation: textFadeIn 0.8s ease forwards 0.5s;
        }

        .intro-subtitle {
            font-size: 0.9rem;
            color: #94a3b8;
            letter-spacing: 3px;
            text-transform: uppercase;
            margin-bottom: 30px;
            opacity: 0;
            animation: textFadeIn 0.8s ease forwards 0.8s;
        }

        /* Loader Circular Premium */
        .loading-ring {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
            opacity: 0;
            animation: spin 1s ease-in-out infinite, textFadeIn 0.5s ease forwards 1s;
        }

        .loading-text {
            display: block;
            margin-top: 15px;
            font-size: 0.75rem;
            color: #64748b;
            font-family: monospace;
            opacity: 0;
            animation: textFadeIn 0.5s ease forwards 1.2s;
        }

        @keyframes rotateCube {
            0% { transform: rotateX(0deg) rotateY(0deg); }
            100% { transform: rotateX(360deg) rotateY(360deg); }
        }
        @keyframes floatCube {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        @keyframes textFadeIn { to { opacity: 1; } }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes pulseBg {
            0% { opacity: 0.5; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.05); }
        }

        /* --- FIM CSS INTRO --- */

        /* --- Layout Principal --- */
        aside {
            width: 260px;
            background: #1e293b;
            color: white;
            display: flex;
            flex-direction: column;
            padding: 20px 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            transition: var(--transition);
            z-index: 10;
        }

        .brand {
            padding: 0 24px 24px;
            border-bottom: 1px solid #334155;
            margin-bottom: 20px;
        }
        .brand h2 { font-size: 1.2rem; font-weight: 600; letter-spacing: 0.5px; }
        .brand span { font-size: 0.75rem; color: #94a3b8; text-transform: uppercase; }

        nav button {
            background: none;
            border: none;
            width: 100%;
            padding: 14px 24px;
            text-align: left;
            color: #94a3b8;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
        }
        nav button:hover, nav button.active {
            color: white;
            background: #334155;
            border-right: 4px solid var(--primary-color);
        }

        main {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            position: relative;
        }

        /* --- Abas --- */
        .tab-content { display: none; animation: fadeIn 0.4s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;
        }
        header h1 { font-size: 1.8rem; font-weight: 700; color: #0f172a; }

        /* --- Cards e Grids --- */
        .grid-cards {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px;
        }
        .card {
            background: var(--bg-panel); padding: 24px; border-radius: var(--border-radius);
            box-shadow: var(--shadow); position: relative; overflow: hidden;
            transition: var(--transition);
        }
        .card h3 { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 10px; font-weight: 500; }
        .card .number { font-size: 2rem; font-weight: 700; color: var(--text-main); }
        .card-icon {
            position: absolute; right: 20px; top: 20px; font-size: 2.5rem; opacity: 0.1; color: var(--primary-color);
        }

        /* --- Tabelas --- */
        .data-table-container {
            background: var(--bg-panel); border-radius: var(--border-radius); box-shadow: var(--shadow); overflow: hidden; overflow-x: auto;
        }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th, td { padding: 16px 24px; text-align: left; border-bottom: 1px solid #e2e8f0; }
        th { background: #f8fafc; font-weight: 600; color: var(--text-muted); font-size: 0.85rem; text-transform: uppercase; }
        tr:hover { background: #f8fafc; }
        .status-badge {
            padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600;
        }
        .status-badge.active { background: #dcfce7; color: #166534; }
        .status-badge.lead { background: #dbeafe; color: #1e40af; }
        .status-badge.pending { background: #fef3c7; color: #92400e; }
        .status-badge.closed { background: #e2e8f0; color: #475569; }
        .status-badge.danger { background: #fecaca; color: #ef4444; }

        /* --- Botões --- */
        .btn {
            padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: 500;
            display: inline-flex; align-items: center; gap: 8px; transition: var(--transition);
        }
        .btn-primary { background: var(--primary-color); color: white; }
        .btn-primary:hover { background: var(--primary-dark); box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2); }
        .btn-outline { background: transparent; border: 1px solid var(--secondary-color); color: var(--text-main); }
        .btn-outline.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        .btn-outline:hover { background: #f8fafc; border-color: var(--primary-color); color: var(--primary-color); }
        .btn-wa { background: #25D366; color: white; border:none; }
        .btn-wa:hover { background: #128C7E; }
        .btn-sm { padding: 6px 12px; font-size: 0.8rem; }
        .btn-icon { padding: 8px; border-radius: 50%; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;}
        .btn-danger-outline { border: 1px solid #fecaca; color: #ef4444; background: white; }
        .btn-danger-outline:hover { background: #fef2f2; border-color: #ef4444; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-glass { background: rgba(255,255,255,0.8); backdrop-filter: blur(4px); border: 1px solid rgba(0,0,0,0.05); color: var(--text-main); }
        .btn-glass:hover { background: rgba(255,255,255,1); box-shadow: var(--shadow); }
        .btn-clean { background: none; border: none; color: #64748b; cursor: pointer; font-size: 0.9rem; }
        .btn-clean:hover { color: var(--primary-color); }

        /* --- Modais --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5);
            display: none; justify-content: center; align-items: center; z-index: 1000;
            backdrop-filter: blur(4px);
        }
        .modal {
            background: white; width: 90%; max-width: 900px; border-radius: 16px; 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            max-height: 90vh; overflow-y: auto; animation: slideUp 0.3s ease;
            display: flex; flex-direction: column;
        }
        .modal-sm { max-width: 500px; }
        .modal-lg { max-width: 1100px; height: 85vh; }
        .modal-xl { max-width: 1400px; height: 90vh; }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 10px; }
        .form-tri { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 10px; }
        .form-full { grid-column: span 2; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 6px; font-size: 0.85rem; font-weight: 600; color: #475569; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 0.95rem; outline: none; transition: border-color 0.2s; background-color: #f8fafc;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { 
            border-color: var(--primary-color); background: #fff; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); 
        }
        .input-money { font-family: monospace; font-weight: 700; color: #334155; }
        .color-picker-wrapper { display: flex; gap: 10px; align-items: center; }
        .color-picker-wrapper input[type=color] { width: 50px; padding: 0; height: 45px; cursor: pointer; border: none; background: none; }
        .modal-header-premium { padding: 25px; background: linear-gradient(to right, #ffffff, #f8fafc); border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; }
        .profile-header-info { display: flex; align-items: center; gap: 20px; }
        .avatar-circle { width: 70px; height: 70px; background: #e0e7ff; color: var(--primary-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; font-weight: bold; border: 2px solid white; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .modal-tabs-nav { display: flex; padding: 0 25px; border-bottom: 1px solid #e2e8f0; background: white; gap: 30px; }
        .modal-tab-btn { padding: 15px 0; background: none; border: none; color: #64748b; font-weight: 500; font-size: 0.9rem; cursor: pointer; position: relative; transition: all 0.2s; }
        .modal-tab-btn:hover { color: var(--primary-color); }
        .modal-tab-btn.active { color: var(--primary-color); font-weight: 600; }
        .modal-tab-btn.active::after { content: ''; position: absolute; bottom: -1px; left: 0; width: 100%; height: 2px; background: var(--primary-color); }
        .modal-body-content { padding: 30px; background: #fff; min-height: 300px; flex: 1; overflow-y: auto;}
        .inner-tab { display: none; animation: fadeIn 0.3s; }
        .inner-tab.active { display: block; }
        .section-title { font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.05em; color: #94a3b8; font-weight: 700; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #f1f5f9; display: flex; align-items: center; gap: 10px; }
        
        /* --- Timeline --- */
        .timeline { position: relative; margin-top: 10px; padding-left: 10px; }
        .timeline-item { position: relative; margin-bottom: 25px; padding-left: 25px; }
        .timeline-item::before { content: ''; position: absolute; left: 0px; top: 25px; bottom: -25px; width: 2px; background: #e2e8f0; z-index: 0; }
        .timeline-item:last-child::before { display: none; }
        .timeline-icon { position: absolute; left: -9px; top: 0; width: 20px; height: 20px; background: white; border-radius: 50%; z-index: 2; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; box-shadow: 0 0 0 2px white; }
        .t-call { background: #dbeafe; color: #2563eb; }
        .t-whatsapp { background: #dcfce7; color: #166534; }
        .t-email { background: #f3e8ff; color: #7e22ce; }
        .t-meeting { background: #ffedd5; color: #c2410c; }
        .t-note { background: #f1f5f9; color: #64748b; }
        .timeline-content { background: #ffffff; padding: 12px 15px; border-radius: 8px; border: 1px solid #e2e8f0; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .timeline-header { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.8rem; }
        .timeline-date { color: var(--text-muted); font-weight: 500; }
        .timeline-type { font-weight: 700; text-transform: uppercase; font-size: 0.65rem; letter-spacing: 0.5px; opacity: 0.7; }

        /* ==========================================================================
           PREMIUM PROJECT MANAGEMENT STYLES (ENTERPRISE 2.0)
           ========================================================================== */
        #albums-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; padding-bottom: 40px; }
        .project-card-premium { background: white; border-radius: 16px; box-shadow: var(--shadow); transition: var(--transition); border: 1px solid #f1f5f9; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .project-card-premium:hover { transform: translateY(-5px); box-shadow: var(--shadow-hover); border-color: #cbd5e1; }
        .pcp-stripe { height: 6px; width: 100%; background: linear-gradient(90deg, var(--primary-color), var(--primary-dark)); }
        .pcp-header { padding: 20px 20px 10px 20px; display: flex; justify-content: space-between; align-items: flex-start; }
        .pcp-info h4 { font-size: 1.05rem; font-weight: 700; color: #1e293b; margin-bottom: 4px; line-height: 1.3; }
        .pcp-client { font-size: 0.85rem; color: #64748b; display: flex; align-items: center; gap: 6px; }
        .pcp-client i { color: var(--primary-color); opacity: 0.7; }
        .pcp-actions { display: flex; gap: 8px; }
        .pcp-btn-action { width: 32px; height: 32px; border-radius: 8px; border: 1px solid #e2e8f0; background: white; color: #64748b; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; }
        .pcp-btn-action:hover { background: #f1f5f9; color: var(--primary-color); border-color: #cbd5e1; }
        .pcp-btn-action.delete:hover { background: #fef2f2; color: #ef4444; border-color: #fca5a5; }
        .pcp-body { padding: 15px 20px; flex: 1; }
        .pcp-stage-info { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 8px; }
        .pcp-stage-label { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; color: #94a3b8; letter-spacing: 0.5px; }
        .pcp-stage-current { font-size: 0.9rem; font-weight: 700; color: var(--primary-color); }
        .pcp-progress-track { height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden; width: 100%; }
        .pcp-progress-fill { height: 100%; background: linear-gradient(90deg, #3b82f6, #2563eb); border-radius: 4px; transition: width 0.5s ease; }
        .pcp-footer { padding: 15px 20px; background: #f8fafc; border-top: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center; }
        .pcp-date { font-size: 0.75rem; color: #94a3b8; }
        .pcp-btn-advance { background: white; border: 1px solid #cbd5e1; color: #475569; font-size: 0.8rem; font-weight: 600; padding: 6px 14px; border-radius: 6px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px; }
        .pcp-btn-advance:hover { background: var(--primary-color); border-color: var(--primary-color); color: white; }
        
        .prj-timeline { display: flex; flex-direction: column; position: relative; padding: 10px 0 10px 25px; }
        .prj-timeline::before { content: ''; position: absolute; left: 20px; top: 10px; bottom: 30px; width: 3px; background: #e2e8f0; z-index: 0; transform: translateX(-50%); }
        .prj-event { display: flex; align-items: center; gap: 20px; margin-bottom: 25px; position: relative; z-index: 1; opacity: 0.6; transition: all 0.3s; }
        .prj-event.completed { opacity: 1; }
        .prj-event.active { opacity: 1; transform: translateX(5px); }
        .prj-dot { width: 40px; height: 40px; border-radius: 50%; background: #ffffff; border: 3px solid #cbd5e1; display: flex; align-items: center; justify-content: center; font-weight: 700; color: #64748b; flex-shrink: 0; position: relative; z-index: 2; }
        .prj-event.completed .prj-dot { background: #dcfce7; border-color: #10b981; color: #166534; }
        .prj-event.active .prj-dot { background: var(--primary-color); border-color: var(--primary-dark); color: white; box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.2); }
        .prj-card { flex: 1; background: white; padding: 16px 20px; border-radius: 12px; border: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .prj-event.active .prj-card { border-color: var(--primary-color); box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.1); }
        .prj-info h4 { margin: 0; font-size: 0.95rem; font-weight: 600; color: #334155; }
        .prj-info p { margin: 2px 0 0 0; font-size: 0.8rem; color: #94a3b8; }
        .workflow-setup-container { display: flex; gap: 30px; height: 100%; }
        .ws-sidebar { width: 30%; border-right: 1px solid #e2e8f0; padding-right: 20px; display:flex; flex-direction:column; gap:20px; }
        .ws-content { flex: 1; overflow-y: auto; }
        .type-card { border: 1px solid #e2e8f0; border-radius: 10px; padding: 15px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 12px; background: white; margin-bottom: 10px; }
        .type-card:hover { border-color: var(--primary-color); transform: translateX(5px); }
        .type-card.selected { border-color: var(--primary-color); background: #eff6ff; }
        .type-icon { width: 40px; height: 40px; border-radius: 8px; background: #e0e7ff; color: var(--primary-color); display: flex; align-items: center; justify-content: center; font-size: 1.1rem; }
        .type-info h4 { font-size: 0.9rem; font-weight: 600; color: #334155; margin-bottom: 2px; }
        .type-info p { font-size: 0.75rem; color: #94a3b8; }
        .step-list-editable { list-style: none; display: flex; flex-direction: column; gap: 10px; }
        .step-item-edit { display: flex; align-items: center; gap: 15px; padding: 12px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; position: relative; }
        .step-num-badge { width: 24px; height: 24px; background: #cbd5e1; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 700; }
        .step-content-edit { flex: 1; }
        .step-content-edit input { border: none; background: transparent; font-size: 0.9rem; width: 100%; color: #334155; font-weight: 500; }
        .step-content-edit input:focus { border-bottom: 1px solid var(--primary-color); outline: none; }
        .prj-action-btn { background: #e2e8f0; color: #475569; border:none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.8rem; font-weight: 600; transition: all 0.2s; }
        .prj-event.active .prj-action-btn { background: var(--primary-color); color: white; }
        .prj-event.active .prj-action-btn:hover { background: var(--primary-dark); }
        
        /* --- CALENDÁRIO & AGENDA --- */
        .calendar-full-container { display: flex; flex-direction: column; height: 100%; }
        .cal-controls { display: flex; justify-content: space-between; align-items: center; padding-bottom: 20px; border-bottom: 1px solid #f1f5f9; margin-bottom: 15px; }
        .cal-controls h3 { font-size: 1.1rem; color: var(--text-main); font-weight: 600; margin: 0; text-transform: capitalize; }
        .cal-btn-group button { background: white; border: 1px solid #e2e8f0; padding: 6px 12px; border-radius: 6px; cursor: pointer; color: var(--text-muted); transition: all 0.2s; }
        .cal-btn-group button:hover { border-color: var(--primary-color); color: var(--primary-color); }
        .cal-month-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: #e2e8f0; border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden; }
        .cal-day-header { background: #f8fafc; padding: 12px 0; text-align: center; font-size: 0.75rem; font-weight: 700; color: #64748b; text-transform: uppercase; }
        .cal-cell { background: white; min-height: 100px; padding: 10px; position: relative; transition: background 0.2s; cursor: pointer; }
        .cal-cell:hover { background: #fdfdfd; }
        .cal-cell-num { font-size: 0.9rem; font-weight: 600; color: #475569; margin-bottom: 5px; display: block; }
        .cal-cell.other-month { background: #fbfbfc; color: #cbd5e1; }
        .cal-cell.other-month .cal-cell-num { color: #cbd5e1; }
        .cal-cell.today { background: #eff6ff; }
        .cal-cell.today .cal-cell-num { color: var(--primary-color); display: inline-block; background: #dbeafe; width: 24px; height: 24px; text-align: center; line-height: 24px; border-radius: 50%; }
        .cal-event-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 3px; }
        .agenda-layout { display: grid; grid-template-columns: 280px 1fr; gap: 20px; height: calc(100vh - 120px); }
        .agenda-sidebar { background: white; border-radius: 12px; padding: 20px; display: flex; flex-direction: column; gap: 20px; box-shadow: var(--shadow); overflow-y: auto;}
        .agenda-main { background: white; border-radius: 12px; padding: 20px; box-shadow: var(--shadow); display: flex; flex-direction: column; }
        .agenda-event-pill { font-size: 0.75rem; padding: 2px 6px; border-radius: 4px; margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: white; cursor: pointer; box-shadow: 0 1px 2px rgba(0,0,0,0.1); opacity: 0.9; }
        .agenda-event-pill:hover { opacity: 1; transform: scale(1.02); }
        .mini-list-item { padding: 10px; border-bottom: 1px solid #f1f5f9; display: flex; gap: 10px; align-items: flex-start; }
        .mini-list-item:last-child { border-bottom: none; }
        .mini-time { font-size: 0.75rem; color: #64748b; font-weight: 600; min-width: 40px; }
        .mini-desc h4 { font-size: 0.85rem; margin-bottom: 2px; color: #334155; }
        .mini-desc p { font-size: 0.75rem; color: #94a3b8; }
        .mini-tag { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-top: 5px; }

        /* --- GESTÃO NAV --- */
        .mgmt-nav { display: flex; gap: 10px; margin-bottom: 25px; background: white; padding: 10px; border-radius: 12px; box-shadow: var(--shadow); overflow-x: auto; }
        .mgmt-nav button { padding: 10px 20px; border: none; background: transparent; border-radius: 8px; color: var(--text-muted); font-weight: 500; cursor: pointer; transition: all 0.2s; white-space: nowrap; }
        .mgmt-nav button:hover { background: #f1f5f9; color: var(--primary-color); }
        .mgmt-nav button.active { background: var(--primary-color); color: white; shadow: 0 4px 6px rgba(37, 99, 235, 0.2); }
        .mgmt-section { display: none; animation: fadeIn 0.3s ease; }
        .mgmt-section.active { display: block; }

        /* --- ESTOQUE & DRE --- */
        .stock-kpi { display: flex; gap: 20px; margin-bottom: 20px; }
        .stock-kpi-card { flex: 1; background: #fff; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0; display:flex; align-items: center; justify-content: space-between; }
        .stock-kpi-card .val { font-size: 1.4rem; font-weight: 700; }
        .stock-kpi-card .label { font-size: 0.8rem; color: #64748b; }
        .dre-table { width: 100%; border-collapse: collapse; font-family: 'Courier New', monospace; }
        .dre-table td, .dre-table th { padding: 12px 15px; border-bottom: 1px solid #e2e8f0; }
        .dre-table tr.total-row { background: #f8fafc; font-weight: bold; }
        .dre-table .val-neg { color: #ef4444; }
        .dre-table .val-pos { color: #166534; }
        .dre-indent { padding-left: 30px; }

        /* =================================================================
           NOVO CSS: CRIADOR DE ORÇAMENTOS PREMIUM (SPLIT VIEW)
           ================================================================= */
        .quote-builder-container {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 30px;
            height: calc(100vh - 200px);
            min-height: 600px;
        }

        /* --- Barra Lateral de Configuração --- */
        .quote-sidebar {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 20px;
            overflow-y: auto;
            border: 1px solid #f1f5f9;
        }
        
        .q-config-group {
            margin-bottom: 25px;
            border-bottom: 1px solid #f1f5f9;
            padding-bottom: 20px;
        }
        .q-config-group:last-child { border:none; }
        .q-config-title {
            font-size: 0.85rem; font-weight: 700; color: #94a3b8; text-transform: uppercase; margin-bottom: 15px;
            display: flex; align-items: center; gap: 8px;
        }

        .upload-box {
            border: 2px dashed #cbd5e1; border-radius: 8px; padding: 15px; text-align: center;
            cursor: pointer; transition: all 0.2s; background: #f8fafc; position: relative;
        }
        .upload-box:hover { border-color: var(--primary-color); background: #eff6ff; }
        .upload-box input[type="file"] {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;
        }
        .upload-preview {
            max-height: 60px; display: block; margin: 10px auto 0; border-radius: 4px; border: 1px solid #e2e8f0;
        }

        .layout-selector { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .layout-opt {
            border: 2px solid #e2e8f0; border-radius: 8px; padding: 10px; text-align: center; cursor: pointer; opacity: 0.7;
        }
        .layout-opt:hover { opacity: 1; border-color: #94a3b8; }
        .layout-opt.active { border-color: var(--primary-color); opacity: 1; background: #eff6ff; color: var(--primary-color); font-weight: 600; }

        /* --- Área de Preview (Papel) --- */
        .quote-preview-container {
            background: #cbd5e1;
            border-radius: 12px;
            padding: 40px;
            overflow-y: auto;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
        }

        .quote-paper {
            width: var(--paper-width);
            min-height: var(--paper-height);
            background: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            padding: 0; /* Layout controla padding */
            position: relative;
            color: #1e293b;
            font-size: 12pt;
            display: flex; flex-direction: column;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* --- Layout Moderno --- */
        .quote-paper.layout-modern { padding: 50px; }
        .quote-paper.layout-modern .q-header { display: flex; justify-content: space-between; margin-bottom: 40px; border-bottom: 2px solid var(--quote-accent); padding-bottom: 20px; }
        .quote-paper.layout-modern .q-logo { max-height: 80px; max-width: 200px; object-fit: contain; }
        .quote-paper.layout-modern .q-title { font-size: 24pt; font-weight: 800; color: var(--quote-accent); text-transform: uppercase; margin-top: 10px; }
        .quote-paper.layout-modern table { margin-top: 30px; width: 100%; border-collapse: collapse; }
        .quote-paper.layout-modern th { background: var(--quote-accent); color: white; padding: 10px; text-transform: uppercase; font-size: 0.9rem; }
        .quote-paper.layout-modern td { padding: 12px 10px; border-bottom: 1px solid #e2e8f0; }
        .quote-paper.layout-modern .q-total-area { margin-top: 40px; text-align: right; font-size: 1.5rem; font-weight: bold; color: var(--quote-accent); }

        /* --- Layout Enterprise (Clean / Folder) --- */
        .quote-paper.layout-enterprise { padding: 0; }
        .quote-paper.layout-enterprise .q-top-bar { height: 15px; background: var(--quote-accent); width: 100%; }
        .quote-paper.layout-enterprise .q-content-pad { padding: 50px; flex: 1; background: rgba(255,255,255,0.9); /* Opacidade para ver fundo */ }
        .quote-paper.layout-enterprise .q-header { display: grid; grid-template-columns: 100px 1fr; gap: 20px; margin-bottom: 50px; align-items: center; }
        .quote-paper.layout-enterprise .q-logo { width: 100px; height: 100px; object-fit: contain; background: #f8fafc; border-radius: 50%; padding: 5px; }
        .quote-paper.layout-enterprise .q-info-box { border: 1px solid #e2e8f0; padding: 15px; border-radius: 8px; background: #fff; margin-bottom: 20px; }
        .quote-paper.layout-enterprise th { border-bottom: 2px solid var(--quote-accent); color: var(--quote-accent); text-align: left; padding: 10px; font-weight: 700; }
        .quote-paper.layout-enterprise tr:nth-child(even) { background: #f8fafc; }
        .quote-paper.layout-enterprise .q-footer { background: #1e293b; color: white; padding: 20px 50px; font-size: 0.8rem; text-align: center; margin-top: auto; }

        @media print {
            body * { visibility: hidden; }
            .quote-paper, .quote-paper * { visibility: visible; }
            .quote-paper { position: absolute; left: 0; top: 0; margin: 0; box-shadow: none; width: 100%; height: auto; min-height: auto; print-color-adjust: exact; -webkit-print-color-adjust: exact; }
            .modal-overlay, aside, header { display: none !important; }
        }

        /* --- Outros Styles do Sistema --- */
        .report-grid-premium { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .kpi-report-card { background: white; border-radius: 12px; padding: 20px; border: 1px solid #f1f5f9; box-shadow: var(--shadow); position: relative; overflow: hidden; display: flex; flex-direction: column; height: 100%; min-height: 200px; }
        .kpi-report-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-hover); border-color: #cbd5e1; }
        .kpi-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .kpi-head h4 { font-size: 0.95rem; color: #1e293b; font-weight: 700; }
        .kpi-head i { font-size: 1.2rem; color: var(--text-muted); opacity: 0.5; }
        .chart-container { flex: 1; display: flex; align-items: flex-end; justify-content: space-around; gap: 8px; padding-top: 10px; padding-bottom: 10px; min-height: 120px; }
        .chart-bar-group { display: flex; flex-direction: column; align-items: center; width: 100%; height: 100%; justify-content: flex-end; }
        .chart-bar { width: 100%; background: #e2e8f0; border-radius: 4px 4px 0 0; position: relative; transition: height 0.5s cubic-bezier(0.4, 0, 0.2, 1); min-width: 20px; max-width: 40px; }
        .chart-bar:hover { opacity: 0.8; }
        .chart-bar.c-primary { background: var(--primary-color); }
        .chart-bar.c-success { background: #10b981; }
        .chart-bar.c-danger { background: #ef4444; }
        .chart-bar.c-warning { background: #f59e0b; }
        .chart-label { font-size: 0.65rem; color: #64748b; margin-top: 6px; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; font-weight: 500;}
        .chart-val-tooltip { position: absolute; top: -25px; left: 50%; transform: translateX(-50%); background: #1e293b; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.65rem; opacity: 0; transition: opacity 0.2s; pointer-events: none; white-space: nowrap; }
        .chart-bar:hover .chart-val-tooltip { opacity: 1; top: -30px; }
        .report-builder-box { background: linear-gradient(135deg, #f8fafc 0%, #eff6ff 100%); border: 1px dashed #cbd5e1; border-radius: 12px; padding: 30px; text-align: center; cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 200px; }
        .report-builder-box:hover { background: #fff; border-color: var(--primary-color); box-shadow: var(--shadow); }
        .report-builder-box i { font-size: 2.5rem; color: var(--primary-color); margin-bottom: 15px; opacity: 0.8; }
        .report-builder-box span { font-weight: 600; color: #1e293b; margin-bottom: 5px; }
        .report-builder-box small { color: #64748b; font-size: 0.8rem; }
        .wa-layout { display: flex; height: 100%; width: 100%; background: #fff; overflow: hidden; border-radius: 0 0 16px 16px; }
        .wa-sidebar { width: 300px; border-right: 1px solid #e2e8f0; display: flex; flex-direction: column; background: white; }
        .wa-header { padding: 10px 16px; background: var(--wa-header); height: 60px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #d1d7db; }
        .wa-search-box { padding: 10px; background: white; border-bottom: 1px solid #f1f5f9; }
        .wa-search-input { width: 100%; background: #f0f2f5; border: none; padding: 8px 15px; border-radius: 8px; outline: none; font-size: 0.9rem; }
        .wa-list { flex: 1; overflow-y: auto; }
        .wa-list-item { padding: 12px 15px; display: flex; align-items: center; gap: 12px; cursor: pointer; border-bottom: 1px solid #f1f5f9; transition: background 0.2s; position: relative;}
        .wa-list-item:hover { background: #f5f6f6; }
        .wa-list-item.active { background: #f0f2f5; }
        .wa-avatar { width: 45px; height: 45px; background: #dfe4ea; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 1.2rem; }
        .wa-list-action-btn { opacity: 0; transition: opacity 0.2s; padding: 4px; margin-left: 5px; cursor: pointer; color: #8696a0; z-index: 10; font-size: 0.9rem;}
        .wa-list-item:hover .wa-list-action-btn { opacity: 1; }
        .wa-list-action-btn:hover { color: var(--primary-color); }
        .wa-chat-area { flex: 1; display: flex; flex-direction: column; background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); background-color: var(--wa-bg); }
        .wa-chat-header { height: 60px; background: var(--wa-header); padding: 10px 16px; display: flex; align-items: center; gap: 15px; border-bottom: 1px solid #d1d7db; }
        .wa-chat-body { flex: 1; padding: 20px 40px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .wa-msg { max-width: 65%; padding: 8px 12px; border-radius: 8px; font-size: 0.9rem; position: relative; box-shadow: 0 1px 1px rgba(0,0,0,0.1); line-height: 1.4; }
        .wa-msg.sent { align-self: flex-end; background: #d9fdd3; }
        .wa-msg.received { align-self: flex-start; background: #ffffff; }
        .wa-msg-meta { font-size: 0.65rem; color: #667781; text-align: right; margin-top: 4px; display: block; }
        .wa-footer { min-height: 62px; background: var(--wa-header); padding: 10px 16px; display: flex; align-items: center; gap: 10px; border-top: 1px solid #d1d7db; }
        .wa-input { flex: 1; background: white; border: none; padding: 12px 15px; border-radius: 8px; outline: none; font-size: 0.95rem; }
        .wa-btn-send { background: none; border: none; color: #54656f; font-size: 1.5rem; cursor: pointer; }
        .wa-btn-send.ready { color: var(--wa-green); }
        .customizer-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; margin-top: 15px; }
        .customizer-item { border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); position: relative; background: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 140px; }
        .customizer-item:hover { transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05); border-color: #cbd5e1; }
        .customizer-item.selected { border-color: var(--primary-color); background: #eff6ff; color: var(--primary-color); }
        .customizer-item i { font-size: 2rem; margin-bottom: 12px; color: #94a3b8; transition: color 0.2s; }
        .customizer-item.selected i { color: var(--primary-color); }
        .customizer-item span { font-weight: 600; font-size: 0.9rem; }
        .check-badge { position: absolute; top: 10px; right: 10px; width: 24px; height: 24px; background: var(--primary-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.7rem; opacity: 0; transform: scale(0); transition: all 0.2s; }
        .customizer-item.selected .check-badge { opacity: 1; transform: scale(1); }
        .home-grid-layout { display: grid; grid-template-columns: 2.5fr 1fr; gap: 30px; }
        @media (max-width: 600px) { .home-grid-layout { grid-template-columns: 1fr; } }

        /* --- FINANCEIRO PREMIUM --- */
        .fin-bi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .fin-card { background: white; border-radius: 12px; padding: 25px; box-shadow: var(--shadow); position: relative; overflow: hidden; display: flex; flex-direction: column; justify-content: space-between; height: 160px; }
        .fin-card-title { font-size: 0.9rem; color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; z-index: 2; }
        .fin-card-value { font-size: 2.2rem; font-weight: 700; color: #1e293b; z-index: 2; margin-top: 10px; }
        .fin-card-bg-icon { position: absolute; right: -10px; bottom: -10px; font-size: 6rem; opacity: 0.05; z-index: 1; transform: rotate(-15deg); }
        .fin-card-trend { font-size: 0.8rem; margin-top: 10px; font-weight: 500; z-index: 2; display: flex; align-items: center; gap: 5px; }
        .fin-card.income { background: linear-gradient(135deg, #ffffff 0%, #f0fdf4 100%); border-bottom: 4px solid #10b981; }
        .fin-card.expense { background: linear-gradient(135deg, #ffffff 0%, #fef2f2 100%); border-bottom: 4px solid #ef4444; }
        .fin-card.balance { background: linear-gradient(135deg, #ffffff 0%, #eff6ff 100%); border-bottom: 4px solid #3b82f6; }
        .fin-progress-container { width: 100%; background: #e2e8f0; height: 6px; border-radius: 3px; margin-top: 15px; overflow: hidden; }
        .fin-progress-bar { height: 100%; border-radius: 3px; }
        .status-badge.paid { background: #dcfce7; color: #166534; }
        .status-badge.received { background: #dcfce7; color: #166534; }
        .status-badge.pending-pay { background: #fef3c7; color: #92400e; }
        .status-badge.late { background: #fee2e2; color: #991b1b; }
        .fin-type-icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; }
        .type-in { background: #dcfce7; color: #166534; }
        .type-out { background: #fee2e2; color: #991b1b; }
        .fin-filter-bar { display: flex; gap: 15px; margin-bottom: 20px; background: white; padding: 15px; border-radius: 12px; box-shadow: var(--shadow); align-items: center; flex-wrap: wrap; }
        .fin-select { padding: 8px 12px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 0.9rem; outline: none; background: #f8fafc; }
        .fin-integration-box { background: linear-gradient(145deg, #f8fafc, #f1f5f9); border: 1px solid #e2e8f0; border-radius: 10px; padding: 15px; margin-bottom: 15px; position: relative; }
        .fin-integration-box::before { content: 'Integração Financeira'; position: absolute; top: -10px; left: 15px; background: var(--primary-color); color: white; font-size: 0.65rem; padding: 2px 8px; border-radius: 10px; font-weight: 600; text-transform: uppercase; }
        .fin-auto-badge { display: inline-flex; align-items: center; gap: 4px; background: #eff6ff; color: #2563eb; font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; border: 1px solid #dbeafe; }
        .var-chip { background: #f1f5f9; color: #475569; padding: 6px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; cursor: pointer; border: 1px solid #e2e8f0; transition: all 0.2s; display: inline-flex; align-items: center; gap: 6px; user-select: none; }
        .var-chip:hover { background: #e0e7ff; color: var(--primary-color); border-color: #cbd5e1; transform: translateY(-1px); }
        .var-chip i { opacity: 0.6; }
        .var-chip.finance { background: #dcfce7; color: #166534; border-color: #bbf7d0; }
        .var-chip.finance:hover { background: #bbf7d0; }
        .var-chip.event { background: #eff6ff; color: #1e40af; border-color: #bfdbfe; }
        .var-chip.event:hover { background: #bfdbfe; }
        .var-list-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; padding: 10px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0; }
        .var-list-title { font-size: 0.75rem; text-transform: uppercase; font-weight: 700; color: #94a3b8; margin-bottom: 8px; display: block; }
        
        /* --- Mobile Responsive Fixes --- */
        @media (max-width: 768px) {
            body { flex-direction: column; overflow-x: hidden; overflow-y: auto; padding-bottom: 80px; }
            #mobile-tab-bar { display: grid; }
            #mobile-menu-trigger { display: flex; }
            aside { position: fixed !important; left: -100% !important; top: 0; width: 85% !important; height: 100vh !important; z-index: 5000 !important; transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1) !important; background: var(--bg-panel) !important; border-radius: 0 24px 24px 0; display: block !important; padding: 20px !important; box-shadow: 10px 0 30px rgba(0,0,0,0.2); }
            aside.open { transform: translateX(100%); }
            main { padding: 15px !important; width: 100% !important; margin: 0 !important; }
            .grid-cards, .home-grid-layout, .form-grid, .form-tri, .agenda-layout, .fin-bi-grid, .workflow-setup-container, .report-grid-premium { grid-template-columns: 1fr !important; display: flex; flex-direction: column; gap: 15px; }
            header { flex-direction: column; align-items: flex-start; gap: 15px; background: white; margin: -15px -15px 15px -15px; padding: 20px 15px; border-bottom: 1px solid #edf2f7; }
            header div { width: 100%; }
            .data-table-container { border: 1px solid #e2e8f0; overflow-x: auto; background: white; border-radius: 16px; }
            table { min-width: 600px; }
            .quote-builder-container { display: flex; flex-direction: column; height: auto; }
            .quote-paper { transform: scale(0.6); transform-origin: top center; margin-bottom: -100px; }
            .modal, .modal-lg, .modal-xl, .modal-sm { width: 100% !important; height: 100% !important; top: 0 !important; left: 0 !important; transform: none !important; max-width: 100% !important; max-height: 100% !important; border-radius: 0; display: flex; flex-direction: column; position: fixed; }
            .modal-overlay { z-index: 6000; padding: 0; align-items: flex-start; }
            .wa-layout { flex-direction: column; height: 100%; }
            .wa-sidebar { width: 100%; height: 40%; border-right: none; border-bottom: 1px solid #eee; }
            .wa-chat-area { flex: 1; height: 60%; }
            .intro-title { font-size: 1.8rem; }
        }
    </style>
</head>
<body class="not-authenticated">

    <div id="supabase-login-overlay">
        <div class="login-card">
            <div class="login-logo"><i class="fas fa-chart-line"></i></div>
            <h1 class="login-title">Legacy CRM</h1>
            <p class="login-subtitle">Enterprise Edition 360</p>
            
            <div class="login-form-group">
                <label>Email de Acesso</label>
                <input type="email" id="login-email" class="login-input" placeholder="seu@email.com" onkeydown="if(event.key === 'Enter') document.getElementById('login-password').focus()">
            </div>
            
            <div class="login-form-group">
                <label>Senha</label>
                <input type="password" id="login-password" class="login-input" placeholder="••••••••" onkeydown="if(event.key === 'Enter') authManager.login()">
            </div>

            <div class="login-error" id="login-error-msg"></div>

            <button class="btn-login" onclick="authManager.login()" id="btn-do-login">Entrar no Sistema</button>
            <button class="btn btn-outline" style="width:100%; margin-top:10px; justify-content:center;"
            
            <p style="margin-top:20px; font-size:0.75rem; color:#94a3b8;">Sistema protegido e criptografado.</p>
        </div>
    </div>
<div id="intro-screen">
        <div class="particles"></div>
        
        <div class="intro-3d-wrapper">
            <div class="cube">
                <div class="cube-face face-front"><i class="fas fa-chart-line"></i></div>
                <div class="cube-face face-back"><i class="fas fa-users"></i></div>
                <div class="cube-face face-right"><i class="fas fa-project-diagram"></i></div>
                <div class="cube-face face-left"><i class="fas fa-wallet"></i></div>
                <div class="cube-face face-top"><i class="fas fa-cube"></i></div>
                <div class="cube-face face-bottom"><i class="fas fa-database"></i></div>
            </div>
        </div>

        <div class="intro-content">
            <h1 class="intro-title">Legacy CRM</h1>
            <p class="intro-subtitle">Enterprise Edition 360</p>
            
            <div class="loading-ring"></div>
            <span class="loading-text">Carregando Módulos...</span>
        </div>
    </div>

    <aside>
        <div class="brand">
            <h2>Legacy CRM</h2>
            <span>Enterprise Edition</span>
        </div>
        <nav>
            <button class="active" onclick="app.nav('home')"><i class="fas fa-home"></i> Início</button>
            <button onclick="app.nav('contacts')"><i class="fas fa-users"></i> Contatos 360º</button>
            <button onclick="app.nav('agenda')"><i class="fas fa-calendar-alt"></i> Agenda</button>
            <button onclick="app.nav('management')"><i class="fas fa-tasks"></i> Gestão Enterprise</button>
            <button onclick="app.nav('config')"><i class="fas fa-cog"></i> Config. Global</button>
            
            <button onclick="authManager.logout()" style="margin-top: auto; border-top: 1px solid #334155; color: #fca5a5;">
                <i class="fas fa-sign-out-alt"></i> Sair do Sistema
            </button>
        </nav>
    </aside>

    <main>
        <section id="tab-home" class="tab-content active">
            <header>
                <div>
                    <h1>Dashboard Principal</h1>
                    <p style="color: var(--text-muted)">Visão geral do sistema</p>
                </div>
                <div style="display: flex; align-items: center; gap: 20px;">
                    <div style="text-align: right;">
                        <h3><i class="far fa-clock"></i> <span id="clock">00:00</span></h3>
                        <small id="date-display">Carregando data...</small>
                    </div>
                    <button class="btn btn-glass btn-sm" onclick="dashboardManager.openModal()">
                        <i class="fas fa-sliders-h"></i> Personalizar
                    </button>
                </div>
            </header>

            <div class="grid-cards">
                <div class="card" id="dash-card-calls">
                    <h3>Atendimentos Hoje</h3>
                    <div class="number">0</div>
                    <i class="fas fa-headset card-icon"></i>
                </div>
                <div class="card" id="dash-card-albums">
                    <h3>Projetos Ativos</h3>
                    <div class="number">0</div>
                    <i class="fas fa-tasks card-icon"></i>
                </div>
                <div class="card" id="dash-card-revenue">
                    <h3>Faturamento Mês</h3>
                    <div class="number" style="color: var(--success)">R$ 0,00</div>
                    <i class="fas fa-wallet card-icon"></i>
                </div>
            </div>

            <div class="home-grid-layout">
                <div class="card" id="dash-card-calendar">
                    <div class="calendar-full-container">
                        <div class="cal-controls">
                            <h3 id="cal-month-year">Janeiro 2024</h3>
                            <div class="cal-btn-group">
                                <button onclick="calendarManager.changeMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                                <button onclick="calendarManager.changeMonth(0)">Hoje</button>
                                <button onclick="calendarManager.changeMonth(1)"><i class="fas fa-chevron-right"></i></button>
                            </div>
                        </div>
                        <div class="cal-day-header-row" style="display: grid; grid-template-columns: repeat(7, 1fr); text-align: center;">
                             <div class="cal-day-header">Dom</div>
                             <div class="cal-day-header">Seg</div>
                             <div class="cal-day-header">Ter</div>
                             <div class="cal-day-header">Qua</div>
                             <div class="cal-day-header">Qui</div>
                             <div class="cal-day-header">Sex</div>
                             <div class="cal-day-header">Sab</div>
                        </div>
                        <div class="cal-month-grid" id="calendar-grid"></div>
                    </div>
                </div>
                
                <div class="card" id="dash-card-events">
                    <h3>Lembretes & Próximos Eventos</h3>
                    <div id="home-agenda-widget" style="margin-top:20px; max-height: 300px; overflow-y: auto;">
                        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 150px; color: var(--text-muted); text-align: center;">
                            <i class="far fa-calendar-check" style="font-size: 2rem; margin-bottom: 10px; opacity: 0.3;"></i>
                            <small>Carregando eventos...</small>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="tab-agenda" class="tab-content">
            <header>
                <h1>Agenda Enterprise</h1>
                <div style="display:flex; gap:10px;">
                    <button class="btn btn-wa" onclick="msgManager.openModal()"><i class="fab fa-whatsapp"></i> Central WhatsApp</button>
                    <button class="btn btn-outline" onclick="agendaManager.openSettings()"><i class="fas fa-sliders-h"></i> Configurar Tipos</button>
                    <button class="btn btn-primary" onclick="agendaManager.openModal()"><i class="fas fa-plus"></i> Novo Agendamento</button>
                </div>
            </header>
            
            <div class="agenda-layout">
                <div class="agenda-sidebar">
                    <div style="border-bottom:1px solid #e2e8f0; padding-bottom:15px; margin-bottom:15px;">
                        <h4 style="margin-bottom:10px; color:#334155;">Filtros de Visualização</h4>
                        <div style="display:flex; flex-direction:column; gap:8px;">
                            <label style="font-size:0.8rem; display:flex; align-items:center; gap:8px;">
                                <input type="checkbox" checked onchange="agendaManager.render()"> Exibir Cancelados
                            </label>
                            <label style="font-size:0.8rem; display:flex; align-items:center; gap:8px;">
                                <input type="checkbox" checked onchange="agendaManager.render()"> Apenas Visitas Externas
                            </label>
                        </div>
                    </div>
                    
                    <h4 style="margin-bottom:15px; color:#334155;">Próximos 7 Dias</h4>
                    <div id="agenda-sidebar-list"></div>
                </div>

                <div class="agenda-main">
                    <div class="cal-controls">
                        <h3 id="agenda-month-year">Janeiro 2024</h3>
                        <div class="cal-btn-group">
                            <button onclick="agendaManager.changeMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                            <button onclick="agendaManager.changeMonth(0)">Hoje</button>
                            <button onclick="agendaManager.changeMonth(1)"><i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>
                     <div class="cal-day-header-row" style="display: grid; grid-template-columns: repeat(7, 1fr); text-align: center;">
                             <div class="cal-day-header">Dom</div>
                             <div class="cal-day-header">Seg</div>
                             <div class="cal-day-header">Ter</div>
                             <div class="cal-day-header">Qua</div>
                             <div class="cal-day-header">Qui</div>
                             <div class="cal-day-header">Sex</div>
                             <div class="cal-day-header">Sab</div>
                        </div>
                    <div class="cal-month-grid" id="agenda-grid" style="flex:1;"></div>
                </div>
            </div>
        </section>

        <section id="tab-contacts" class="tab-content">
            <header>
                <h1>Contatos 360º</h1>
                <button class="btn btn-primary" onclick="contactManager.openModal()"><i class="fas fa-plus"></i> Novo Cadastro</button>
            </header>

            <div class="card" style="margin-bottom: 20px;">
                <div class="form-grid" style="margin-top: 0; display: flex; gap: 10px;">
                    <input type="text" id="searchContact" placeholder="Buscar por nome, email ou telefone..." onkeyup="contactManager.search()" style="flex:1; padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px;">
                    <select id="filterType" onchange="contactManager.search()" style="padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px;">
                        <option value="">Todos os Tipos</option>
                        <option value="Cliente">Cliente</option>
                        <option value="Prospect">Prospect</option>
                        <option value="Lead">Lead</option>
                        <option value="Fornecedor">Fornecedor</option>
                    </select>
                </div>
            </div>

            <div class="data-table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Tipo</th>
                            <th>Contato</th>
                            <th>Status (Funil)</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="contacts-list"></tbody>
                </table>
            </div>
        </section>

        <section id="tab-management" class="tab-content">
            <header>
                <h1>Gestão & Estratégia</h1>
                <p style="color: var(--text-muted);">Controle total de projetos, financeiro e estoque</p>
            </header>
            
            <div class="mgmt-nav">
                <button class="active" onclick="mgmt.switch('albums')"><i class="fas fa-project-diagram"></i> Projetos & Workflow</button>
                <button onclick="financeManager.openDashboard()"><i class="fas fa-chart-line"></i> Financeiro PRO</button>
                <button onclick="mgmt.switch('stock')"><i class="fas fa-boxes"></i> Estoque</button>
                <button onclick="mgmt.switch('opps')"><i class="fas fa-funnel-dollar"></i> Oportunidades</button>
                <button onclick="mgmt.switch('dre')"><i class="fas fa-balance-scale"></i> DRE Contábil</button>
                <button onclick="mgmt.switch('reports')"><i class="fas fa-chart-pie"></i> Relatórios</button>
                <button onclick="mgmt.switch('quotes')"><i class="fas fa-file-invoice-dollar"></i> Orçamentos Premium</button>
                <button onclick="mgmt.switch('company')"><i class="fas fa-building"></i> Dados Empresa</button>
            </div>
            
            <div id="mgmt-albums" class="mgmt-section active">
                <div style="display:flex; justify-content:space-between; margin-bottom:20px; align-items:center;">
                    <div>
                        <h3>Acompanhamento de Projetos</h3>
                        <p style="font-size: 0.8rem; color: #64748b;">Gerencie etapas, prazos e entregas.</p>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <button class="btn btn-outline btn-sm" onclick="albumManager.openConfig()"><i class="fas fa-cogs"></i> Configurar Workflows</button>
                        <button class="btn btn-primary" onclick="albumManager.openModal()"><i class="fas fa-plus"></i> Novo Projeto</button>
                    </div>
                </div>
                <div id="albums-container"></div>
            </div>

            <div id="mgmt-stock" class="mgmt-section">
                <div class="stock-kpi">
                    <div class="stock-kpi-card">
                        <div>
                            <div class="label">Total de Produtos</div>
                            <div class="val" id="stk-total-count">0</div>
                        </div>
                        <i class="fas fa-box" style="color: var(--primary-color); opacity: 0.5;"></i>
                    </div>
                    <div class="stock-kpi-card">
                        <div>
                            <div class="label">Valuation (Custo)</div>
                            <div class="val" id="stk-valuation" style="color: var(--success);">R$ 0,00</div>
                        </div>
                        <i class="fas fa-dollar-sign" style="color: var(--success); opacity: 0.5;"></i>
                    </div>
                    <div class="stock-kpi-card">
                        <div>
                            <div class="label">Baixo Estoque</div>
                            <div class="val" id="stk-low-alert" style="color: var(--danger);">0</div>
                        </div>
                        <i class="fas fa-exclamation-triangle" style="color: var(--danger); opacity: 0.5;"></i>
                    </div>
                </div>

                <div class="card">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap:10px;">
                        <div style="display: flex; gap: 10px; flex: 1;">
                            <input type="text" id="stock-search" placeholder="Buscar produto..." style="padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px; flex: 1;" onkeyup="stockManager.load()">
                            <button class="btn btn-outline" onclick="stockManager.load()"><i class="fas fa-search"></i></button>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-outline" onclick="stockManager.openMovementModal()"><i class="fas fa-exchange-alt"></i> Movimentação</button>
                            <button class="btn btn-primary" onclick="stockManager.openProductModal()"><i class="fas fa-plus"></i> Novo Produto</button>
                        </div>
                    </div>

                    <div class="data-table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>SKU / Nome</th>
                                    <th>Categoria</th>
                                    <th>Estoque Atual</th>
                                    <th>Preço Venda</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="stock-list"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="mgmt-opps" class="mgmt-section">
                <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                    <h3>Funil de Vendas</h3>
                    <button class="btn btn-primary btn-sm" onclick="oppManager.openModal()"><i class="fas fa-plus"></i> Nova Oportunidade</button>
                </div>
                <div class="data-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Título</th>
                                <th>Cliente</th>
                                <th>Valor Est.</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="opps-list">
                            <tr><td colspan="5" style="text-align:center; padding:20px; color:#64748b;">Nenhuma oportunidade registrada.</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="mgmt-dre" class="mgmt-section">
                <div class="card">
                    <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                        <h3>Demonstrativo do Resultado do Exercício (DRE)</h3>
                        <div style="font-size:0.9rem; color:#64748b;">Simulação Contábil (Baseado no Financeiro)</div>
                    </div>
                    <table class="dre-table">
                        <tr><td>(+) RECEITA OPERACIONAL BRUTA</td><td class="text-right val-pos" id="dre-receita">R$ 0,00</td></tr>
                        <tr><td class="dre-indent">(-) Deduções / Impostos (Simulado 6%)</td><td class="text-right val-neg" id="dre-impostos">(R$ 0,00)</td></tr>
                        <tr class="total-row"><td>(=) RECEITA LÍQUIDA</td><td class="text-right" id="dre-rec-liq">R$ 0,00</td></tr>
                        <tr><td class="dre-indent">(-) Custos Operacionais</td><td class="text-right val-neg" id="dre-custos">(R$ 0,00)</td></tr>
                        <tr class="total-row"><td>(=) LUCRO BRUTO</td><td class="text-right val-pos" id="dre-lucro-bruto">R$ 0,00</td></tr>
                        <tr><td class="dre-indent">(-) Despesas Administrativas/Fixas</td><td class="text-right val-neg" id="dre-despesas">(R$ 0,00)</td></tr>
                        <tr class="total-row" style="background: #ecfdf5; font-size:1.1rem;"><td>(=) RESULTADO LÍQUIDO (LUCRO/PREJUÍZO)</td><td class="text-right val-pos" id="dre-resultado">R$ 0,00</td></tr>
                    </table>
                </div>
            </div>

            <div id="mgmt-reports" class="mgmt-section">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <div>
                        <h3>Central de Inteligência (BI)</h3>
                        <p style="font-size:0.85rem; color:#64748b;">Análise em tempo real dos seus dados.</p>
                    </div>
                    <button class="btn btn-primary" onclick="reportManager.openBuilder()"><i class="fas fa-plus"></i> Criar Relatório Personalizado</button>
                </div>
                <div class="report-grid-premium">
                    <div class="kpi-report-card">
                        <div class="kpi-head"><h4>Fluxo de Caixa (Ult. 6 Meses)</h4><i class="fas fa-chart-line"></i></div>
                        <div class="chart-container" id="chart-revenue"></div>
                    </div>
                    <div class="kpi-report-card">
                        <div class="kpi-head"><h4>Origem de Clientes</h4><i class="fas fa-users"></i></div>
                        <div class="chart-container" id="chart-clients"></div>
                    </div>
                    <div class="kpi-report-card">
                        <div class="kpi-head"><h4>Status de Projetos</h4><i class="fas fa-tasks"></i></div>
                        <div class="chart-container" id="chart-projects"></div>
                    </div>
                </div>
                <h4 class="section-title" style="margin-top:30px;">Relatórios Personalizados Salvos</h4>
                <div id="saved-reports-container" class="grid-cards" style="grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));">
                    <div class="report-builder-box" onclick="reportManager.openBuilder()">
                        <i class="fas fa-plus-circle"></i>
                        <span>Novo Relatório</span>
                        <small>Customizar filtros e dados</small>
                    </div>
                </div>
            </div>

            <div id="mgmt-quotes" class="mgmt-section">
                <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                    <h3>Construtor de Propostas Premium</h3>
                    <div style="display:flex; gap:10px;">
                        <button class="btn btn-outline" onclick="document.getElementById('quotes-history').style.display='block'; document.getElementById('quote-builder-area').style.display='none';"><i class="fas fa-history"></i> Histórico</button>
                        <button class="btn btn-primary" onclick="quoteManager.newQuote()"><i class="fas fa-file-alt"></i> Novo Orçamento</button>
                    </div>
                </div>
                
                <div id="quotes-history" class="data-table-container" style="display:none;">
                     <table>
                        <thead>
                            <tr><th>ID</th><th>Cliente</th><th>Data</th><th>Total</th><th>Ações</th></tr>
                        </thead>
                        <tbody id="quote-history-body">
                            <tr><td colspan="5" style="text-align:center; padding:20px; color:#64748b;">Nenhum orçamento gerado.</td></tr>
                        </tbody>
                     </table>
                </div>

                <div id="quote-builder-area">
                    <div class="quote-builder-container">
                        <div class="quote-sidebar">
                            <div class="q-config-group">
                                <div class="q-config-title"><i class="fas fa-palette"></i> Identidade Visual</div>
                                <div class="form-group">
                                    <label>Cor de Destaque</label>
                                    <div class="color-picker-wrapper">
                                        <input type="color" id="q-accent-color" value="#2563eb" onchange="quoteManager.updateSettings()">
                                        <small style="color:#64748b;">Aplica em bordas e títulos</small>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Logotipo da Empresa</label>
                                    <div class="upload-box">
                                        <i class="fas fa-cloud-upload-alt"></i> Importar Logo
                                        <input type="file" accept="image/*" onchange="quoteManager.handleLogoUpload(this)">
                                    </div>
                                    <img id="q-logo-preview" class="upload-preview" style="display:none;">
                                </div>
                                <div class="form-group">
                                    <label>Fundo do Papel (Folder Base)</label>
                                    <div class="upload-box">
                                        <i class="fas fa-image"></i> Importar Arte de Fundo
                                        <input type="file" accept="image/*" onchange="quoteManager.handleBgUpload(this)">
                                    </div>
                                    <div style="margin-top:5px; display:flex; justify-content:space-between;">
                                        <small style="color:#64748b;">Transparência:</small>
                                        <input type="range" id="q-bg-opacity" min="0" max="1" step="0.1" value="1" onchange="quoteManager.updateSettings()">
                                    </div>
                                </div>
                            </div>

                            <div class="q-config-group">
                                <div class="q-config-title"><i class="fas fa-layer-group"></i> Layout</div>
                                <div class="layout-selector">
                                    <div class="layout-opt active" onclick="quoteManager.setLayout('modern')" id="layout-btn-modern">Moderno</div>
                                    <div class="layout-opt" onclick="quoteManager.setLayout('enterprise')" id="layout-btn-enterprise">Enterprise</div>
                                </div>
                            </div>

                            <div class="q-config-group">
                                <div class="q-config-title"><i class="fas fa-user-tie"></i> Dados do Cliente</div>
                                <div class="form-group">
                                    <input type="text" id="q-client-name" placeholder="Nome do Cliente" oninput="quoteManager.updatePreview()">
                                </div>
                                <div class="form-group">
                                    <input type="text" id="q-client-doc" placeholder="CPF/CNPJ (Opcional)" oninput="quoteManager.updatePreview()">
                                </div>
                            </div>

                            <div class="q-config-group">
                                <div class="q-config-title"><i class="fas fa-list"></i> Itens do Orçamento</div>
                                <button class="btn btn-sm btn-outline" style="width:100%; margin-bottom:10px;" onclick="quoteManager.addItem()"><i class="fas fa-plus"></i> Adicionar Item</button>
                                <div id="q-items-list-sidebar" style="font-size:0.8rem; color:#64748b;">
                                    </div>
                            </div>

                            <button class="btn btn-success" style="width:100%;" onclick="quoteManager.printPdf()"><i class="fas fa-print"></i> Imprimir / PDF</button>
                        </div>

                        <div class="quote-preview-container">
                            <div id="paper-preview" class="quote-paper layout-modern">
                                </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="mgmt-company" class="mgmt-section">
                <div class="card">
                    <h3>Dados da Organização</h3>
                    <p style="color:var(--text-muted); margin-bottom:20px;">Esses dados aparecerão no cabeçalho dos orçamentos e relatórios.</p>
                    <div class="form-grid">
                        <div class="form-group form-full">
                            <label>Razão Social / Nome Fantasia</label>
                            <input type="text" id="conf-company-name" value="RC Sistemas" oninput="quoteManager.updatePreview()">
                        </div>
                        <div class="form-group">
                            <label>CNPJ</label>
                            <input type="text" id="conf-company-cnpj" value="00.000.000/0001-00" oninput="quoteManager.updatePreview()">
                        </div>
                        <div class="form-group">
                            <label>Telefone / Contato</label>
                            <input type="text" id="conf-company-phone" value="(21) 99999-9999" oninput="quoteManager.updatePreview()">
                        </div>
                        <div class="form-group form-full">
                            <label>Endereço Completo</label>
                            <input type="text" id="conf-company-addr" value="Av. Comercial, 1000 - Centro, RJ" oninput="quoteManager.updatePreview()">
                        </div>
                        <div class="form-group form-full">
                             <button class="btn btn-primary"><i class="fas fa-save"></i> Salvar Configurações</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="tab-config" class="tab-content">
            <header>
                <h1>Configurações Globais</h1>
                <p style="color:var(--text-muted)">Personalização visual e comportamento do sistema</p>
            </header>

            <div class="card">
                <h3>Aparência do Sistema</h3>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Cor Primária</label>
                        <input type="color" id="cfg-primary">
                    </div>

                    <div class="form-group">
                        <label>Cor Secundária</label>
                        <input type="color" id="cfg-secondary">
                    </div>

                    <div class="form-group">
                        <label>Tamanho da Fonte</label>
                        <select id="cfg-font">
                            <option value="14">Pequena</option>
                            <option value="16">Normal</option>
                            <option value="18">Grande</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Modo Escuro</label>
                        <select id="cfg-theme">
                            <option value="light">Claro</option>
                            <option value="dark">Escuro</option>
                        </select>
                    </div>

                    <div class="form-group form-full">
                        <button class="btn btn-primary" onclick="globalConfig.save()">
                            <i class="fas fa-save"></i> Salvar Personalização
                        </button>
                    </div>
              </div>
            </div>

            <div class="card" style="margin-top: 20px; border-top: 4px solid var(--warning);">
                <h3 style="display:flex; align-items:center; gap:10px;"><i class="fas fa-database"></i> Backup & Restauração de Dados</h3>
                <p style="color:var(--text-muted); margin-bottom:15px; font-size: 0.9rem;">
                    Exporte todos os dados do sistema (Clientes, Financeiro, Estoque, etc.) para um arquivo JSON seguro.
                    Utilize o botão "Restaurar" para carregar um arquivo previamente salvo.
                </p>
                <div style="display:flex; gap:15px; flex-wrap:wrap;">
                    <button class="btn btn-primary" onclick="backupManager.exportData()">
                        <i class="fas fa-download"></i> Baixar Backup Completo
                    </button>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <button class="btn btn-outline" onclick="document.getElementById('restore-file-input').click()">
                            <i class="fas fa-upload"></i> Restaurar Arquivo
                        </button>
                        <input type="file" id="restore-file-input" style="display:none" accept=".json" onchange="backupManager.importData(this)">
                    </div>
                </div>
                <p id="backup-status" style="margin-top:10px; font-size:0.8rem; color:var(--text-muted);"></p>
            </div>
                </div>
            </div>
        </section>

    </main>

    <div id="custom-report-modal" class="modal-overlay">
        <div class="modal modal-lg">
            <div class="modal-header-premium">
                <h3>Construtor de Relatório</h3>
                <button class="btn btn-sm btn-outline" onclick="document.getElementById('custom-report-modal').style.display='none'">Fechar</button>
            </div>
            <div class="modal-body-content">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Nome do Relatório</label>
                        <input type="text" id="rep-name" placeholder="Ex: Vendas de Janeiro">
                    </div>
                    <div class="form-group">
                        <label>Tipo de Dados</label>
                        <select id="rep-source">
                            <option value="financial">Financeiro (Receitas/Despesas)</option>
                            <option value="contacts">Contatos (Clientes/Leads)</option>
                            <option value="stock">Estoque (Inventário)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Filtrar Data Início</label>
                        <input type="date" id="rep-start">
                    </div>
                    <div class="form-group">
                        <label>Filtrar Data Fim</label>
                        <input type="date" id="rep-end">
                    </div>
                </div>
                <button class="btn btn-primary" style="width:100%; margin-bottom:20px;" onclick="reportManager.generatePreview()">Gerar Pré-visualização</button>
                <div id="rep-preview-area" class="data-table-container" style="display:none; margin-bottom:20px; max-height:300px; overflow-y:auto;">
                    <table id="rep-preview-table"></table>
                </div>
                <div style="text-align:right;">
                    <button class="btn btn-success" onclick="reportManager.saveReport()"><i class="fas fa-save"></i> Salvar nos Relatórios</button>
                </div>
            </div>
        </div>
    </div>

    <div id="financial-dashboard-modal" class="modal-overlay">
        <div class="modal modal-xl">
            <div class="modal-header-premium">
                <div>
                    <h3 style="font-size: 1.2rem; color: #1e293b;">Financeiro Enterprise Pro</h3>
                    <p style="font-size: 0.85rem; color: #64748b;">Gestão completa de Contas a Pagar e Receber (BI)</p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-primary" onclick="financeManager.openForm()"><i class="fas fa-plus"></i> Novo Lançamento</button>
                    <button class="btn btn-sm btn-outline" onclick="document.getElementById('financial-dashboard-modal').style.display='none'">Fechar</button>
                </div>
            </div>
            <div class="modal-body-content" style="background: #f8fafc;">
                <div class="fin-bi-grid">
                    <div class="fin-card income">
                        <div class="fin-card-title">Receitas Realizadas</div>
                        <div class="fin-card-value" id="bi-income">R$ 0,00</div>
                        <div class="fin-card-trend"><i class="fas fa-arrow-up" style="color:#166534"></i> Entradas do período</div>
                        <i class="fas fa-coins fin-card-bg-icon"></i>
                        <div class="fin-progress-container"><div class="fin-progress-bar" style="background: #10b981; width: 0%" id="bi-bar-income"></div></div>
                    </div>
                    <div class="fin-card expense">
                        <div class="fin-card-title">Despesas Pagas</div>
                        <div class="fin-card-value" id="bi-expense">R$ 0,00</div>
                        <div class="fin-card-trend"><i class="fas fa-arrow-down" style="color:#ef4444"></i> Saídas do período</div>
                        <i class="fas fa-file-invoice-dollar fin-card-bg-icon"></i>
                         <div class="fin-progress-container"><div class="fin-progress-bar" style="background: #ef4444; width: 0%" id="bi-bar-expense"></div></div>
                    </div>
                    <div class="fin-card balance">
                        <div class="fin-card-title">Saldo Líquido</div>
                        <div class="fin-card-value" id="bi-balance">R$ 0,00</div>
                        <div class="fin-card-trend" id="bi-balance-txt">Resultado Operacional</div>
                        <i class="fas fa-scale-balanced fin-card-bg-icon"></i>
                         <div class="fin-progress-container"><div class="fin-progress-bar" style="background: #3b82f6; width: 0%" id="bi-bar-balance"></div></div>
                    </div>
                </div>
                <div class="fin-filter-bar">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <label style="font-size:0.85rem; font-weight:600; color:#475569;">Período:</label>
                        <input type="month" id="fin-filter-month" class="fin-select" onchange="financeManager.render()">
                    </div>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <label style="font-size:0.85rem; font-weight:600; color:#475569;">Tipo:</label>
                        <select id="fin-filter-type" class="fin-select" onchange="financeManager.render()">
                            <option value="all">Todas</option>
                            <option value="in">Entradas</option>
                            <option value="out">Saídas</option>
                        </select>
                    </div>
                    <div style="flex:1;"></div>
                    <button class="btn btn-sm btn-outline" onclick="financeManager.render()"><i class="fas fa-sync-alt"></i> Atualizar</button>
                </div>
                <div class="data-table-container">
                    <table>
                        <thead>
                            <tr><th style="width: 50px;">Tipo</th><th>Descrição</th><th>Categoria</th><th>Vencimento</th><th>Valor</th><th>Status</th><th style="text-align: right;">Ações</th></tr>
                        </thead>
                        <tbody id="fin-list-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="financial-form-modal" class="modal-overlay" style="z-index: 1100;">
        <div class="modal modal-sm">
            <div class="modal-header-premium">
                <h3>Lançamento Financeiro</h3>
                <button class="btn btn-sm btn-outline" onclick="document.getElementById('financial-form-modal').style.display='none'">X</button>
            </div>
            <div class="modal-body-content">
                <form id="fin-form" onsubmit="financeManager.save(event)">
                    <div class="form-group">
                        <label>Tipo de Movimento</label>
                        <select id="fin-type" required onchange="financeManager.updateCategories()">
                            <option value="in">Receita / Entrada (+)</option>
                            <option value="out">Despesa / Saída (-)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Descrição</label>
                        <input type="text" id="fin-desc" placeholder="Ex: Pagamento Cliente X ou Conta Luz" required>
                    </div>
                     <div class="form-group">
                        <label>Categoria</label>
                        <select id="fin-cat" required></select>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Valor (R$)</label>
                            <input type="number" step="0.01" id="fin-value" class="input-money" required>
                        </div>
                        <div class="form-group">
                            <label>Vencimento / Data</label>
                            <input type="date" id="fin-date" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Status Inicial</label>
                         <select id="fin-status">
                            <option value="paid">Pago / Recebido</option>
                            <option value="pending">Pendente / A Pagar</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Salvar Lançamento</button>
                </form>
            </div>
        </div>
    </div>

    <div id="dashboard-customizer-modal" class="modal-overlay">
        <div class="modal modal-lg" style="max-width: 800px; height: auto; max-height: 80vh;">
            <div class="modal-header-premium">
                <div>
                    <h3 style="font-size: 1.2rem; color: #1e293b;">Personalizar Dashboard</h3>
                    <p style="font-size: 0.85rem; color: #64748b;">Selecione os widgets que deseja exibir na tela inicial</p>
                </div>
                <button class="btn btn-sm btn-outline" onclick="dashboardManager.closeModal()">Fechar</button>
            </div>
            <div class="modal-body-content" style="background: #f8fafc;">
                <div class="customizer-grid" id="customizer-grid-container"></div>
                <div style="margin-top: 30px; text-align: right; padding-top: 20px; border-top: 1px solid #e2e8f0;">
                    <button class="btn btn-outline" style="margin-right: 10px;" onclick="dashboardManager.resetDefaults()">Restaurar Padrão</button>
                    <button class="btn btn-primary" onclick="dashboardManager.saveSettings()">Salvar Alterações</button>
                </div>
            </div>
        </div>
    </div>

    <div id="event-modal" class="modal-overlay">
        <div class="modal modal-sm" style="max-width: 600px;">
            <div class="modal-header-premium">
                <h3 id="evt-modal-title">Novo Agendamento</h3>
                <button class="btn btn-sm btn-outline" onclick="document.getElementById('event-modal').style.display='none'">X</button>
            </div>
            <div class="modal-body-content">
                <form id="event-form" onsubmit="agendaManager.saveEvent(event)">
                    <input type="hidden" id="evt-id">
                    <div class="form-group">
                        <label>Título do Evento</label>
                        <input type="text" id="evt-title" required placeholder="Ex: Reunião de Alinhamento">
                    </div>
                    <div class="form-group">
                        <label>Cliente</label>
                        <select id="evt-client" onchange="agendaManager.populateClientData()">
                            <option value="">Selecione um cliente...</option>
                        </select>
                    </div>
                    <div class="form-group">
                         <label>Endereço da Visita/Evento</label>
                         <input type="text" id="evt-address" placeholder="Rua, Número, Bairro...">
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Tipo Agendamento</label>
                            <select id="evt-type" required></select>
                        </div>
                        <div class="form-group">
                             <label>Tipo de Visita</label>
                             <select id="evt-visit-type" required></select>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Data</label>
                            <input type="date" id="evt-date" required>
                        </div>
                        <div class="form-group">
                            <label>Hora</label>
                            <input type="time" id="evt-time" required>
                        </div>
                    </div>
                    <div class="fin-integration-box">
                        <div class="form-tri">
                            <div class="form-group">
                                <label style="color:#2563eb;">Valor Total</label>
                                <input type="number" id="evt-val-total" class="input-money" step="0.01" placeholder="0.00" oninput="agendaManager.calcFinancials()" style="background:white; border-color:#bfdbfe;">
                            </div>
                            <div class="form-group">
                                <label style="color:#166534;">Sinal / Entrada <i class="fas fa-arrow-down" style="font-size:0.7rem;"></i></label>
                                <input type="number" id="evt-val-signal" class="input-money" step="0.01" placeholder="0.00" oninput="agendaManager.calcFinancials()" style="background:white; border-color:#bbf7d0;">
                            </div>
                            <div class="form-group">
                                <label style="color:#b91c1c;">Restante (Auto)</label>
                                <input type="number" id="evt-val-rest" class="input-money" readonly style="background:#fef2f2; color: #b91c1c; border-color:#fecaca;">
                            </div>
                        </div>
                        <small style="display:block; margin-top:5px; color:#64748b; font-size:0.75rem;">
                            <i class="fas fa-info-circle"></i> O sistema lançará o <strong>Sinal</strong> como Receita Hoje e o <strong>Restante</strong> para a Data do Evento no Financeiro Pro.
                        </small>
                    </div>
                    <div class="form-group">
                        <label>Observações</label>
                        <textarea id="evt-notes" rows="3"></textarea>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                         <button type="button" id="btn-delete-event" class="btn btn-danger-outline" style="display:none;" onclick="agendaManager.deleteEvent()">Excluir</button>
                         <button type="submit" class="btn btn-primary" style="flex: 1;"><i class="fas fa-save"></i> Salvar na Agenda</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="whatsapp-modal" class="modal-overlay">
        <div class="modal modal-lg">
             <div class="modal-header-premium" style="padding: 15px 20px; background: var(--wa-header);">
                <div style="display:flex; align-items:center; gap:10px;">
                    <i class="fab fa-whatsapp" style="font-size: 1.5rem; color: #25D366;"></i>
                    <h3 style="margin:0; font-size:1rem;">Central WhatsApp Integrada</h3>
                </div>
                <button class="btn btn-sm btn-outline" onclick="document.getElementById('whatsapp-modal').style.display='none'">Fechar</button>
            </div>
            
            <div class="wa-layout">
                <div class="wa-sidebar">
                    <div class="wa-header">
                        <div class="wa-avatar"><i class="fas fa-user"></i></div>
                        <div style="display:flex; gap:15px; color: #54656f;">
                            <i class="fas fa-circle-notch"></i>
                            <i class="fas fa-comment-alt"></i>
                            <i class="fas fa-ellipsis-v"></i>
                        </div>
                    </div>
                    <div class="wa-search-box">
                         <div style="display:flex; gap:10px; margin-bottom:10px; justify-content:center;">
                            <button class="btn btn-sm btn-outline active" id="btn-wa-view-contacts" onclick="msgManager.switchView('contacts')">Contatos</button>
                            <button class="btn btn-sm btn-outline" id="btn-wa-view-templates" onclick="msgManager.switchView('templates')">Modelos</button>
                         </div>
                         <input type="text" class="wa-search-input" id="wa-search-input" placeholder="Pesquisar..." onkeyup="msgManager.search()">
                    </div>
                    <div class="wa-list" id="wa-list-container"></div>
                </div>

                <div class="wa-chat-area" id="wa-main-area">
                    <div id="wa-view-chat" style="display:flex; flex-direction:column; height:100%;">
                        <div class="wa-chat-header">
                            <div class="wa-avatar" id="wa-chat-avatar"><i class="fas fa-user"></i></div>
                            <div style="flex:1;">
                                <h4 id="wa-chat-name" style="font-size:0.95rem; font-weight:500;">Selecione um contato</h4>
                                <small id="wa-chat-phone" style="color: #667781;">-</small>
                            </div>
                            <div style="color: #54656f; font-size:1.2rem;">
                                <i class="fas fa-search"></i>
                            </div>
                        </div>
                        <div class="wa-chat-body" id="wa-chat-body">
                             <div style="align-self:center; background:#ffebb6; padding:5px 10px; border-radius:8px; font-size:0.75rem; color:#555; margin-bottom:20px; text-align:center; box-shadow: 0 1px 1px rgba(0,0,0,0.1);">
                                 <i class="fas fa-lock" style="font-size:0.7rem; margin-right:4px;"></i> As mensagens são enviadas via API oficial do seu dispositivo.
                             </div>
                             <div class="wa-msg sent">
                                Selecione um contato na esquerda para iniciar a conversa.
                                <span class="wa-msg-meta">10:00 <i class="fas fa-check-double" style="color:#53bdeb;"></i></span>
                             </div>
                        </div>
                        <div class="wa-footer">
                            <i class="far fa-smile" style="color:#54656f; font-size:1.5rem; cursor:pointer;"></i>
                            <input type="text" class="wa-input" id="wa-input-msg" placeholder="Digite uma mensagem" onkeyup="msgManager.checkInput()">
                            <button class="wa-btn-send" id="wa-btn-send" onclick="msgManager.sendMessage()"><i class="fas fa-paper-plane"></i></button>
                        </div>
                    </div>

                    <div id="wa-view-new-template" style="display:none; height:100%; flex-direction:column; background: #fff;">
                        <div style="padding: 20px; border-bottom: 1px solid #e2e8f0; background: #f8fafc;">
                            <h3 style="margin-bottom: 5px; color: #1e293b;" id="tpl-editor-title">Novo Modelo de Mensagem</h3>
                            <p style="font-size: 0.8rem; color: #64748b;">As variáveis buscam automaticamente dados do <strong>próximo evento</strong> do cliente.</p>
                        </div>
                        <div style="padding: 20px; flex: 1; overflow-y: auto;">
                            <input type="hidden" id="tpl-edit-id">
                            <div class="form-group">
                                <label>Título do Modelo (Interno)</label>
                                <input type="text" id="tpl-new-title" placeholder="Ex: Cobrança Suave">
                            </div>
                            <div class="form-group">
                                <label style="display:flex; justify-content:space-between;">
                                    <span>Conteúdo da Mensagem</span>
                                    <span style="font-size:0.7rem; color:var(--primary-color);">Clique nas variáveis abaixo para inserir</span>
                                </label>
                                <div class="var-list-container">
                                    <span class="var-list-title"><i class="fas fa-user-tag"></i> Dados Básicos:</span>
                                    <div class="var-chip" onclick="msgManager.insertVar('Nome')"><i class="fas fa-user"></i> [Nome]</div>
                                    <div class="var-chip" onclick="msgManager.insertVar('Empresa')"><i class="fas fa-building"></i> [Empresa]</div>
                                    <div class="var-chip" onclick="msgManager.insertVar('Telefone')"><i class="fas fa-phone"></i> [Telefone]</div>
                                </div>
                                <div class="var-list-container">
                                    <span class="var-list-title"><i class="far fa-calendar-alt"></i> Próximo Evento:</span>
                                    <div class="var-chip event" onclick="msgManager.insertVar('Data')"><i class="far fa-calendar"></i> [Data]</div>
                                    <div class="var-chip event" onclick="msgManager.insertVar('Hora')"><i class="far fa-clock"></i> [Hora]</div>
                                    <div class="var-chip event" onclick="msgManager.insertVar('Endereco')"><i class="fas fa-map-marker-alt"></i> [Endereco]</div>
                                </div>
                                <div class="var-list-container">
                                    <span class="var-list-title"><i class="fas fa-dollar-sign"></i> Financeiro (Evento):</span>
                                    <div class="var-chip finance" onclick="msgManager.insertVar('Sinal')"><i class="fas fa-hand-holding-usd"></i> [Sinal]</div>
                                    <div class="var-chip finance" onclick="msgManager.insertVar('Restante')"><i class="fas fa-money-bill-wave"></i> [Restante]</div>
                                    <div class="var-chip finance" onclick="msgManager.insertVar('Total')"><i class="fas fa-calculator"></i> [Total]</div>
                                </div>
                                <textarea id="tpl-new-text" rows="8" placeholder="Olá [Nome], tudo bem?..." style="font-family:inherit; line-height:1.5;"></textarea>
                            </div>
                        </div>
                        <div style="padding: 20px; border-top: 1px solid #e2e8f0; background: #f8fafc; text-align: right; display: flex; justify-content: flex-end; gap: 10px;">
                            <button class="btn btn-outline" onclick="msgManager.cancelTemplateCreation()">Cancelar</button>
                            <button class="btn btn-primary" onclick="msgManager.saveNewTemplate()">Salvar Modelo</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="contact-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header-premium">
                <div class="profile-header-info">
                    <div class="avatar-circle" id="header-avatar"><i class="fas fa-user"></i></div>
                    <div>
                        <h2 id="header-name" style="font-size: 1.4rem; color: #1e293b; margin-bottom: 2px;">Novo Contato</h2>
                        <span id="header-id" style="font-size: 0.8rem; color: #64748b; background: #f1f5f9; padding: 2px 8px; border-radius: 4px;">ID: #NOVO</span>
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-outline" onclick="contactManager.closeModal()">Cancelar</button>
                    <button class="btn btn-primary" onclick="document.getElementById('main-submit-btn').click()"><i class="fas fa-save"></i> Salvar Ficha</button>
                </div>
            </div>
            <div class="modal-tabs-nav">
                <button class="modal-tab-btn active" onclick="contactManager.switchTab('basic')"><i class="far fa-id-card"></i> Dados Principais</button>
                <button class="modal-tab-btn" onclick="contactManager.switchTab('address')"><i class="fas fa-map-marker-alt"></i> Endereço</button>
                <button class="modal-tab-btn" onclick="contactManager.switchTab('profile')"><i class="fas fa-network-wired"></i> Social & Mídia</button>
                <button class="modal-tab-btn" onclick="contactManager.switchTab('history')"><i class="fas fa-history"></i> Histórico & Timeline</button>
            </div>
            <div class="modal-body-content">
                <form id="contact-form" onsubmit="contactManager.save(event)">
                    <input type="hidden" id="c-id">
                    <button type="submit" id="main-submit-btn" style="display:none;"></button>

                    <div id="modal-tab-basic" class="inner-tab active">
                        <div class="section-title"><i class="fas fa-info-circle"></i> Informações Cadastrais</div>
                        <div class="form-grid">
                            <div class="form-group form-full">
                                <label>Nome Completo / Razão Social</label>
                                <input type="text" id="c-name" required oninput="document.getElementById('header-name').innerText = this.value || 'Novo Contato'">
                            </div>
                            <div class="form-group"><label>CPF / CNPJ</label><input type="text" id="c-cpf"></div>
                            <div class="form-group"><label>Cargo / Função</label><input type="text" id="c-job"></div>
                            <div class="form-group">
                                <label>Tipo de Cadastro</label>
                                <select id="c-type" required><option value="Cliente">Cliente</option><option value="Prospect">Prospect</option><option value="Lead">Lead</option><option value="Fornecedor">Fornecedor</option><option value="Parceiro">Parceiro</option></select>
                            </div>
                            <div class="form-group">
                                <label>Status</label>
                                <select id="c-status"><option value="Ativo">Ativo</option><option value="Negociacao">Em Negociação</option><option value="Pendente">Pagamento Pendente</option><option value="Inativo">Inativo</option></select>
                            </div>
                            <div class="section-title form-full" style="margin-top: 20px;"><i class="fas fa-phone-alt"></i> Contato Direto</div>
                            <div class="form-group"><label>Celular / WhatsApp</label><input type="text" id="c-phone"></div>
                            <div class="form-group"><label>Email Principal</label><input type="email" id="c-email"></div>
                        </div>
                    </div>

                    <div id="modal-tab-address" class="inner-tab">
                        <div class="section-title"><i class="fas fa-map-signs"></i> Localização</div>
                        <div class="form-grid">
                            <div class="form-group"><label>CEP</label><input type="text" id="c-cep"></div>
                            <div class="form-group"><label>Cidade</label><input type="text" id="c-city"></div>
                            <div class="form-group form-full"><label>Logradouro</label><input type="text" id="c-address"></div>
                            <div class="form-group"><label>Número</label><input type="text" id="c-number"></div>
                            <div class="form-group"><label>Bairro</label><input type="text" id="c-district"></div>
                            <div class="form-group form-full"><label>Complemento</label><input type="text" id="c-complement"></div>
                        </div>
                    </div>

                    <div id="modal-tab-profile" class="inner-tab">
                        <div class="section-title"><i class="fas fa-share-alt"></i> Redes Sociais & Origem</div>
                        <div class="form-grid">
                            <div class="form-group"><label>Instagram</label><input type="text" id="c-insta"></div>
                            <div class="form-group"><label>LinkedIn / Facebook</label><input type="text" id="c-social2"></div>
                            <div class="form-group"><label>Data Nascimento/Fundação</label><input type="date" id="c-birth"></div>
                            <div class="form-group"><label>Origem</label><select id="c-source"><option value="Google">Google / Site</option><option value="Indicação">Indicação</option><option value="Instagram">Instagram</option><option value="Outro">Outro</option></select></div>
                            <div class="form-group form-full"><label>Bio / Notas</label><textarea id="c-notes" rows="3"></textarea></div>
                        </div>
                    </div>

                    <div id="modal-tab-history" class="inner-tab">
                        <div id="timeline-controls" style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 15px; margin-bottom: 20px; border-radius: 8px;">
                            <h4 style="margin-bottom: 10px; font-size: 0.9rem;">Adicionar Interação</h4>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <select id="note-type" style="padding: 10px; border-radius: 6px; border: 1px solid #cbd5e1; width: 140px; background:white;">
                                    <option value="note">📝 Nota</option>
                                    <option value="call">📞 Ligação</option>
                                    <option value="whatsapp">💬 WhatsApp</option>
                                    <option value="meeting">🤝 Reunião</option>
                                    <option value="email">📧 Email</option>
                                </select>
                                <input type="text" id="new-note" placeholder="Descreva o que foi conversado..." style="flex: 1; min-width: 250px; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; outline: none;">
                                <button type="button" class="btn btn-primary btn-sm" onclick="contactManager.addTimeline()">Registrar</button>
                            </div>
                        </div>
                        <div class="timeline" id="c-timeline-display" style="max-height: 350px; overflow-y: auto;"></div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div id="album-modal" class="modal-overlay">
        <div class="modal modal-lg">
            <div class="modal-header-premium">
                <div>
                    <h3 style="font-size: 1.2rem; color: #1e293b;">Central de Projetos & Workflow</h3>
                    <p style="font-size: 0.85rem; color: #64748b;" id="alb-modal-subtitle">Gestão de Workflow</p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-outline btn-sm" onclick="document.getElementById('album-modal').style.display='none'">Fechar</button>
                    <button class="btn btn-primary btn-sm" onclick="albumManager.saveMainForm()"><i class="fas fa-save"></i> Salvar</button>
                </div>
            </div>
            <div class="modal-tabs-nav" id="alb-tabs-nav"></div>
            
            <div class="modal-body-content">
                <div id="alb-view-config" style="display:none; height:100%;">
                    <div class="workflow-setup-container">
                        <div class="ws-sidebar">
                            <button class="btn btn-primary btn-sm" onclick="albumManager.newType()" style="width:100%"><i class="fas fa-plus"></i> Novo Tipo de Projeto</button>
                            <div id="alb-types-list" style="overflow-y:auto; flex:1;"></div>
                        </div>
                        <div class="ws-content" id="alb-config-content">
                            <div style="text-align:center; padding-top:50px; color:#94a3b8;">
                                <i class="fas fa-tasks" style="font-size:3rem; margin-bottom:20px; opacity:0.3;"></i>
                                <p>Selecione um tipo de projeto à esquerda para editar suas fases.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="alb-view-project" style="display:none;">
                    <form id="album-form"> <input type="hidden" id="alb-id">
                        <div class="form-grid" style="margin-bottom:20px;">
                            <div class="form-group">
                                <label>Cliente</label>
                                <select id="alb-client-select" style="width:100%"></select>
                            </div>
                            <div class="form-group">
                                <label>Tipo de Projeto</label>
                                <select id="alb-type-select" onchange="albumManager.updateStagesPreview()"></select>
                            </div>
                             <div class="form-group form-full">
                                <label>Nome do Projeto</label>
                                <input type="text" id="alb-name" placeholder="Ex: Casamento Silva e Souza">
                            </div>
                        </div>
                        <div class="card" style="box-shadow:none; border:1px solid #e2e8f0; padding:0;">
                            <div style="padding:15px; background:#f8fafc; border-bottom:1px solid #e2e8f0;">
                                <h4 style="font-size:0.9rem; font-weight:600;">Linha do Tempo (Workflow)</h4>
                            </div>
                            <div style="padding:20px; background:white;">
                                <div class="prj-timeline" id="alb-timeline-preview"></div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="agenda-settings-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header-premium">
                <h3>Configurações de Agenda</h3>
                <button class="btn btn-sm btn-outline" onclick="document.getElementById('agenda-settings-modal').style.display='none'">X</button>
            </div>
            <div class="modal-tabs-nav">
                <button class="modal-tab-btn active" onclick="agendaManager.switchSettingsTab('types')">Tipos e Legendas</button>
                <button class="modal-tab-btn" onclick="agendaManager.switchSettingsTab('visits')">Tipos de Visita</button>
            </div>
            <div class="modal-body-content">
                <div id="set-tab-types" class="inner-tab active">
                    <div class="form-grid" style="align-items: end; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #f1f5f9;">
                        <div class="form-group">
                            <label>Novo Tipo / Legenda</label>
                            <input type="text" id="new-type-name" placeholder="Ex: Instalação">
                        </div>
                        <div class="form-group">
                            <label>Cor da Legenda</label>
                            <div class="color-picker-wrapper">
                                <input type="color" id="new-type-color" value="#2563eb">
                                <span style="font-size: 0.8rem; color: #64748b;">Escolha a cor</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <button class="btn btn-primary" onclick="agendaManager.addType()">Adicionar</button>
                        </div>
                    </div>
                    <div class="data-table-container">
                        <table>
                            <thead><tr><th>Legenda</th><th>Cor</th><th>Ação</th></tr></thead>
                            <tbody id="agenda-types-list"></tbody>
                        </table>
                    </div>
                </div>
                <div id="set-tab-visits" class="inner-tab">
                    <div class="form-grid" style="align-items: end; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #f1f5f9;">
                        <div class="form-group form-full">
                            <label>Novo Tipo de Visita</label>
                            <input type="text" id="new-visit-name" placeholder="Ex: Presencial / Online">
                        </div>
                        <div class="form-group">
                             <button class="btn btn-primary" onclick="agendaManager.addVisitType()">Adicionar</button>
                        </div>
                    </div>
                    <div class="data-table-container">
                        <table>
                            <thead><tr><th>Tipo de Visita</th><th>Ação</th></tr></thead>
                            <tbody id="agenda-visits-list"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="opp-modal" class="modal-overlay">
        <div class="modal modal-sm">
            <div class="modal-header-premium">
                <h3>Nova Oportunidade</h3>
                <button class="btn btn-sm btn-outline" onclick="oppManager.closeModal()">X</button>
            </div>
            <div class="modal-body-content">
                <form id="opp-form" onsubmit="oppManager.save(event)">
                    <div class="form-group">
                        <label>Título da Oportunidade</label>
                        <input type="text" id="opp-title" placeholder="Ex: Projeto Casamento Silva" required>
                    </div>
                    <div class="form-group">
                        <label>Cliente</label>
                        <input type="text" id="opp-client" placeholder="Nome do Cliente" required>
                    </div>
                    <div class="form-group">
                        <label>Valor Estimado</label>
                        <input type="number" id="opp-value" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="opp-status">
                            <option value="Prospect">Prospecção</option>
                            <option value="Proposal">Proposta Enviada</option>
                            <option value="Negotiation">Negociação</option>
                            <option value="Closed">Fechado</option>
                            <option value="Lost">Perdido</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%">Salvar Oportunidade</button>
                </form>
            </div>
        </div>
    </div>

    <div id="product-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header-premium">
                <h3 id="prod-modal-title">Novo Produto</h3>
                <button class="btn btn-sm btn-outline" onclick="document.getElementById('product-modal').style.display='none'">X</button>
            </div>
            <div class="modal-body-content">
                <form id="product-form" onsubmit="stockManager.saveProduct(event)">
                    <input type="hidden" id="prod-id">
                    <div class="form-grid">
                        <div class="form-group form-full">
                            <label>Nome do Produto</label>
                            <input type="text" id="prod-name" required placeholder="Ex: Álbum 20x20 Couro">
                        </div>
                        <div class="form-group">
                            <label>SKU / Código</label>
                            <input type="text" id="prod-sku">
                        </div>
                        <div class="form-group">
                            <label>Categoria</label>
                            <input type="text" id="prod-category" placeholder="Ex: Álbuns, Pendrives, Molduras">
                        </div>
                        <div class="form-group">
                            <label>Preço de Custo (R$)</label>
                            <input type="number" step="0.01" id="prod-cost">
                        </div>
                        <div class="form-group">
                            <label>Preço de Venda (R$)</label>
                            <input type="number" step="0.01" id="prod-price" required>
                        </div>
                        <div class="form-group">
                            <label>Estoque Mínimo</label>
                            <input type="number" id="prod-min" value="5">
                        </div>
                        <div class="form-group">
                            <label>Fornecedor (Opcional)</label>
                            <input type="text" id="prod-supplier" placeholder="Nome do Fornecedor">
                        </div>
                        <div class="form-group form-full">
                            <label>Descrição / Detalhes</label>
                            <textarea id="prod-desc" rows="2"></textarea>
                        </div>
                        <div class="form-group form-full">
                            <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Salvar Produto</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="movement-modal" class="modal-overlay">
        <div class="modal modal-sm">
            <div class="modal-header-premium">
                <h3>Movimentação de Estoque</h3>
                <button class="btn btn-sm btn-outline" onclick="document.getElementById('movement-modal').style.display='none'">X</button>
            </div>
            <div class="modal-body-content">
                <form id="movement-form" onsubmit="stockManager.saveMovement(event)">
                    <div class="form-group">
                        <label>Produto</label>
                        <select id="mov-product" required onchange="stockManager.updateCurrentStockDisplay()">
                            <option value="">Selecione...</option>
                            </select>
                        <small id="mov-current-stock-display" style="color:var(--text-muted)">Saldo Atual: -</small>
                    </div>
                    <div class="form-group">
                        <label>Tipo de Movimento</label>
                        <select id="mov-type" required>
                            <option value="entry">Entrada (+)</option>
                            <option value="exit">Saída (-)</option>
                            <option value="adjust">Ajuste de Inventário (=)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Quantidade</label>
                        <input type="number" id="mov-qty" min="1" required>
                    </div>
                    <div class="form-group">
                        <label>Motivo / Observação</label>
                        <input type="text" id="mov-reason" placeholder="Ex: Compra NF 123 ou Venda Balcão">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%">Confirmar Movimento</button>
                </form>
            </div>
        </div>
    </div>
  
<script>

const SUPABASE_URL='https://rjyxkouegrropsarrhje.supabase.co',SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJqeXhrb3VlZ3Jyb3BzYXJyaGplIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1NjYxNjcsImV4cCI6MjA4NTE0MjE2N30.UjNPnVBVhQcUSirXeWZ3RmYmAhDMqqbbVUChG_Mv57U';window['supabaseClient']=supabase['createClient'](SUPABASE_URL,SUPABASE_KEY);const authManager={'init':async()=>{const {data:{session:I}}=await supabaseClient['auth']['getSession']();authManager['updateUI'](I),supabaseClient['auth']['onAuthStateChange']((d,e)=>{authManager['updateUI'](e);});},'updateUI':I=>{const d=document['body'];I?(d['classList']['remove']('not-authenticated'),d['classList']['add']('authenticated'),typeof app!=='undefined'&&!app['initialized']&&(app['init'](),app['initialized']=!![])):(d['classList']['remove']('authenticated'),d['classList']['add']('not-authenticated'));},'login':async()=>{const I=document['getElementById']('login-email')['value'],d=document['getElementById']('login-password')['value'],e=document['getElementById']('login-error-msg'),M=document['getElementById']('btn-do-login');if(!I||!d){authManager['showError']('Preencha\x20email\x20e\x20senha.');return;}M['innerText']='Autenticando...',M['disabled']=!![],e['style']['display']='none';const {data:L,error:b}=await supabaseClient['auth']['signInWithPassword']({'email':I,'password':d});M['innerText']='Entrar\x20no\x20Sistema',M['disabled']=![];if(b)authManager['showError']('Erro:\x20'+b['message']);else{}},'logout':async()=>{confirm('Deseja\x20sair\x20do\x20sistema?')&&await supabaseClient['auth']['signOut']();},'showError':I=>{const d=document['getElementById']('login-error-msg');d['innerText']=I,d['style']['display']='block';}};authManager['init']();const DB_NAME='lg_crmDB',DB_VERSION=0x7;class DB{constructor(){this['db']=null;}async['connect'](){return new Promise((I,d)=>{const e=indexedDB['open'](DB_NAME,DB_VERSION);e['onupgradeneeded']=M=>{const L=M['target']['result'];if(!L['objectStoreNames']['contains']('contacts'))L['createObjectStore']('contacts',{'keyPath':'id','autoIncrement':!![]});if(!L['objectStoreNames']['contains']('albums'))L['createObjectStore']('albums',{'keyPath':'id','autoIncrement':!![]});if(!L['objectStoreNames']['contains']('opps'))L['createObjectStore']('opps',{'keyPath':'id','autoIncrement':!![]});if(!L['objectStoreNames']['contains']('products'))L['createObjectStore']('products',{'keyPath':'id','autoIncrement':!![]});if(!L['objectStoreNames']['contains']('movements'))L['createObjectStore']('movements',{'keyPath':'id','autoIncrement':!![]});if(!L['objectStoreNames']['contains']('events'))L['createObjectStore']('events',{'keyPath':'id','autoIncrement':!![]});if(!L['objectStoreNames']['contains']('eventTypes'))L['createObjectStore']('eventTypes',{'keyPath':'id','autoIncrement':!![]});if(!L['objectStoreNames']['contains']('visitTypes'))L['createObjectStore']('visitTypes',{'keyPath':'id','autoIncrement':!![]});if(!L['objectStoreNames']['contains']('transactions'))L['createObjectStore']('transactions',{'keyPath':'id','autoIncrement':!![]});if(!L['objectStoreNames']['contains']('customReports'))L['createObjectStore']('customReports',{'keyPath':'id','autoIncrement':!![]});},e['onsuccess']=M=>{this['db']=M['target']['result'],console['log']('.'),I(this['db']);},e['onerror']=M=>d(M);});}async['getAll'](I){return new Promise(d=>{const e=this['db']['transaction']([I],'readonly'),M=e['objectStore'](I),L=M['getAll']();L['onsuccess']=()=>d(L['result']);});}async['put'](I,d){return new Promise(e=>{const M=this['db']['transaction']([I],'readwrite'),L=M['objectStore'](I),b=L['put'](d);b['onsuccess']=()=>e(b['result']);});}async['delete'](I,d){return new Promise(e=>{const M=this['db']['transaction']([I],'readwrite'),L=M['objectStore'](I);L['delete'](d),M['oncomplete']=()=>e();});}}const db=new DB(),backupManager={'exportData':async()=>{try{const I=['contacts','albums','opps','products','movements','events','eventTypes','visitTypes','transactions','customReports'],d={'timestamp':new Date()['toISOString'](),'version':'6.0','data':{}};document['getElementById']('backup-status')['innerText']='Gerando\x20arquivo\x20de\x20backup...';for(const b of I){d['data'][b]=await db['getAll'](b);}d['localStorage']={'dashboardSettings':localStorage['getItem']('dashboardSettings'),'rc_global_config':localStorage['getItem']('rc_global_config'),'projectTypes':localStorage['getItem']('projectTypes'),'waTemplates':localStorage['getItem']('waTemplates')};const M='data:text/json;charset=utf-8,'+encodeURIComponent(JSON['stringify'](d)),L=document['createElement']('a');L['setAttribute']('href',M),L['setAttribute']('download','backup_crm_rc_'+new Date()['toISOString']()['slice'](0x0,0xa)+'.json'),document['body']['appendChild'](L),L['click'](),L['remove'](),document['getElementById']('backup-status')['innerText']='Backup\x20baixado\x20com\x20sucesso!',setTimeout(()=>document['getElementById']('backup-status')['innerText']='',0xbb8);}catch(v){alert('Erro\x20ao\x20exportar\x20dados:\x20'+v['message']);}},'importData':async I=>{const d=I['files'][0x0];if(!d)return;if(!confirm('ATENÇÃO:\x20Isso\x20irá\x20adicionar/sobrescrever\x20dados\x20no\x20sistema\x20atual.\x20Recomenda-se\x20fazer\x20um\x20backup\x20antes.\x20Continuar?')){I['value']='';return;}const e=new FileReader();document['getElementById']('backup-status')['innerText']='Lendo\x20arquivo...',e['onload']=async M=>{try{const L=JSON['parse'](M['target']['result']);if(!L['data'])throw new Error('Arquivo\x20de\x20backup\x20inválido.');for(const b in L['data']){const v=L['data'][b];if(Array['isArray'](v))for(const B of v){await db['put'](b,B);}}if(L['localStorage'])for(const T in L['localStorage']){L['localStorage'][T]&&localStorage['setItem'](T,L['localStorage'][T]);}alert('Dados\x20restaurados\x20com\x20sucesso!\x20O\x20sistema\x20será\x20recarregado.'),window['location']['reload']();}catch(N){alert('Erro\x20ao\x20processar\x20backup:\x20'+N['message']),document['getElementById']('backup-status')['innerText']='Erro\x20na\x20restauração.';}},e['readAsText'](d);}},quoteManager={'state':{'items':[],'color':'#2563eb','logo':null,'bg':null,'opacity':0x1,'layout':'modern'},'newQuote':()=>{document['getElementById']('quotes-history')['style']['display']='none',document['getElementById']('quote-builder-area')['style']['display']='block',quoteManager['state']['items']=[],document['getElementById']('q-items-list-sidebar')['innerHTML']='',document['getElementById']('q-client-name')['value']='',document['getElementById']('q-client-doc')['value']='',quoteManager['updatePreview']();},'handleLogoUpload':I=>{if(I['files']&&I['files'][0x0]){const d=new FileReader();d['onload']=M=>{quoteManager['state']['logo']=M['target']['result'],document['getElementById']('q-logo-preview')['src']=M['target']['result'],document['getElementById']('q-logo-preview')['style']['display']='block',quoteManager['updatePreview']();},d['readAsDataURL'](I['files'][0x0]);}},'handleBgUpload':I=>{if(I['files']&&I['files'][0x0]){const d=new FileReader();d['onload']=M=>{quoteManager['state']['bg']=M['target']['result'],quoteManager['updatePreview']();},d['readAsDataURL'](I['files'][0x0]);}},'updateSettings':()=>{quoteManager['state']['color']=document['getElementById']('q-accent-color')['value'],quoteManager['state']['opacity']=document['getElementById']('q-bg-opacity')['value'],quoteManager['updatePreview']();},'setLayout':I=>{quoteManager['state']['layout']=I,document['querySelectorAll']('.layout-opt')['forEach'](d=>d['classList']['remove']('active')),document['getElementById']('layout-btn-'+I)['classList']['add']('active'),quoteManager['updatePreview']();},'addItem':()=>{const I=prompt('Descrição\x20do\x20Item:');if(!I)return;const d=parseFloat(prompt('Valor\x20Unitário:','0')||0x0),e=parseInt(prompt('Quantidade:','1')||0x1);quoteManager['state']['items']['push']({'desc':I,'price':d,'qty':e}),quoteManager['renderSidebarItems'](),quoteManager['updatePreview']();},'renderSidebarItems':()=>{const I=document['getElementById']('q-items-list-sidebar');I['innerHTML']='',quoteManager['state']['items']['forEach']((d,e)=>{I['innerHTML']+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:flex;\x20justify-content:space-between;\x20border-bottom:1px\x20dashed\x20#e2e8f0;\x20padding:5px\x200;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+d['qty']+'x\x20'+d['desc']+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>R$\x20'+(d['price']*d['qty'])['toFixed'](0x2)+'\x20<i\x20class=\x22fas\x20fa-trash\x22\x20style=\x22cursor:pointer;\x20color:#ef4444;\x20margin-left:5px;\x22\x20onclick=\x22quoteManager.removeItem('+e+')\x22></i></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';});},'removeItem':I=>{quoteManager['state']['items']['splice'](I,0x1),quoteManager['renderSidebarItems'](),quoteManager['updatePreview']();},'updatePreview':()=>{const I=document['getElementById']('paper-preview'),d=quoteManager['state'],e=document['getElementById']('q-client-name')['value']||'Nome\x20do\x20Cliente',M=document['getElementById']('q-client-doc')['value']||'',L=document['getElementById']('conf-company-name')['value'],b=document['getElementById']('conf-company-cnpj')['value'],v=document['getElementById']('conf-company-phone')['value'],B=document['getElementById']('conf-company-addr')['value'];I['style']['setProperty']('--quote-accent',d['color']),I['className']='quote-paper\x20layout-'+d['layout'];d['bg']?(I['style']['backgroundImage']='url('+d['bg']+')',I['style']['backgroundColor']='rgba(255,255,255,'+(0x1-d['opacity'])+')'):(I['style']['backgroundImage']='none',I['style']['backgroundColor']='white');let T=0x0;const N=d['items']['map'](P=>{return T+=P['qty']*P['price'],'<tr><td>'+P['desc']+'</td><td>'+P['qty']+'</td><td>R$\x20'+P['price']['toFixed'](0x2)+'</td><td>R$\x20'+(P['qty']*P['price'])['toFixed'](0x2)+'</td></tr>';})['join'](''),z=new Date()['toLocaleDateString']();d['layout']==='modern'?I['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22q-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(d['logo']?'<img\x20src=\x22'+d['logo']+'\x22\x20class=\x22q-logo\x22>':'<h2>'+L+'</h2>')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22font-size:0.8rem;\x20color:#64748b;\x22>'+b+'\x20|\x20'+v+'<br>'+B+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:right;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22q-title\x22>Orçamento</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Data:\x20'+z+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Cliente:\x20<strong>'+e+'</strong><br><small>'+M+'</small></p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<table>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<thead><tr><th>Descrição</th><th>Qtd</th><th>Unit.</th><th>Total</th></tr></thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tbody>'+(N||'<tr><td\x20colspan=\x224\x22\x20style=\x22text-align:center;\x20padding:30px;\x20color:#cbd5e1;\x22>Adicione\x20itens\x20ao\x20lado...</td></tr>')+'</tbody>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</table>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22q-total-area\x22>Total:\x20R$\x20'+T['toFixed'](0x2)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':I['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22q-top-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22q-content-pad\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22q-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(d['logo']?'<img\x20src=\x22'+d['logo']+'\x22\x20class=\x22q-logo\x22>':'<div\x20style=\x22background:'+d['color']+';\x20width:80px;\x20height:80px;\x20border-radius:50%;\x22></div>')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20style=\x22color:'+d['color']+';\x20font-size:2rem;\x20margin-bottom:5px;\x22>'+L+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22color:#64748b;\x20font-size:0.9rem;\x22>Soluções\x20Profissionais</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:grid;\x20grid-template-columns:\x201fr\x201fr;\x20gap:20px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22q-info-box\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small\x20style=\x22color:#94a3b8;\x20text-transform:uppercase;\x20font-weight:700;\x22>De:</small><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>'+L+'</strong><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+b+'<br>'+v+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22q-info-box\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small\x20style=\x22color:#94a3b8;\x20text-transform:uppercase;\x20font-weight:700;\x22>Para:</small><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>'+e+'</strong><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+M+'<br>Data:\x20'+z+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<table\x20style=\x22width:100%;\x20margin-top:30px;\x20border-collapse:collapse;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<thead><tr><th>Item</th><th>Qtd</th><th>Unitário</th><th>Subtotal</th></tr></thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tbody>'+(N||'<tr><td\x20colspan=\x224\x22\x20style=\x22text-align:center;\x20padding:30px;\x20color:#cbd5e1;\x22>Adicione\x20itens...</td></tr>')+'</tbody>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</table>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:right;\x20margin-top:30px;\x20font-size:1.8rem;\x20font-weight:800;\x20color:'+d['color']+';\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20R$\x20'+T['toFixed'](0x2)+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22q-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Documento\x20gerado\x20digitalmente\x20por\x20Legacy\x20CRM\x20Enterprise.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';},'printPdf':()=>{window['print']();}},reportManager={'init':async()=>{await reportManager['loadSaved'](),await reportManager['renderCharts']();},'loadSaved':async()=>{const I=await db['getAll']('customReports'),d=document['getElementById']('saved-reports-container');d['innerHTML']='<div\x20class=\x22report-builder-box\x22\x20onclick=\x22reportManager.openBuilder()\x22><i\x20class=\x22fas\x20fa-plus-circle\x22></i><span>Novo\x20Relatório</span><small>Customizar\x20filtros\x20e\x20dados</small></div>',I['forEach'](e=>{const M='<div\x20class=\x22card\x22\x20style=\x22cursor:pointer;\x20transition:all\x200.2s;\x20border:1px\x20solid\x20#e2e8f0;\x22\x20onclick=\x22alert(\x27Visualização\x20Detalhada\x20em\x20breve\x27)\x22><div\x20style=\x22display:flex;\x20align-items:center;\x20gap:10px;\x20margin-bottom:10px;\x22><div\x20style=\x22width:35px;\x20height:35px;\x20background:#eff6ff;\x20color:var(--primary-color);\x20border-radius:8px;\x20display:flex;\x20align-items:center;\x20justify-content:center;\x22><i\x20class=\x22fas\x20fa-chart-pie\x22></i></div><h4\x20style=\x22margin:0;\x20font-size:0.95rem;\x22>'+e['name']+'</h4></div><p\x20style=\x22font-size:0.8rem;\x20color:#64748b;\x22>Fonte:\x20'+e['source']+'\x20<br>\x20Criado\x20em:\x20'+new Date(e['createdAt'])['toLocaleDateString']()+'</p></div>';d['insertAdjacentHTML']('beforeend',M);});},'openBuilder':()=>{document['getElementById']('custom-report-modal')['style']['display']='flex',document['getElementById']('rep-name')['value']='',document['getElementById']('rep-preview-area')['style']['display']='none';},'generatePreview':async()=>{const I=document['getElementById']('rep-source')['value'],d=document['getElementById']('rep-start')['value'],e=document['getElementById']('rep-end')['value'];let M=[],L=[],b=[];if(I==='financial'){const B=await db['getAll']('transactions');M=B['filter'](T=>(!d||T['date']>=d)&&(!e||T['date']<=e)),L=['Data','Descrição','Valor','Tipo'],b=M['map'](T=>'<tr><td>'+T['date']+'</td><td>'+T['desc']+'</td><td>R$\x20'+T['value']+'</td><td>'+T['type']+'</td></tr>');}else{if(I==='contacts'){const T=await db['getAll']('contacts');M=T,L=['Nome','Tipo','Email','Telefone'],b=M['map'](N=>'<tr><td>'+N['name']+'</td><td>'+N['type']+'</td><td>'+N['email']+'</td><td>'+N['phone']+'</td></tr>');}else{if(I==='stock'){const N=await db['getAll']('products');M=N,L=['Produto','Estoque','Preço','Custo'],b=M['map'](z=>'<tr><td>'+z['name']+'</td><td>'+z['stock']+'</td><td>'+z['price']+'</td><td>'+z['cost']+'</td></tr>');}}}const v='<thead><tr>'+L['map'](z=>'<th>'+z+'</th>')['join']('')+'</tr></thead><tbody>'+b['join']('')+'</tbody>';document['getElementById']('rep-preview-table')['innerHTML']=v,document['getElementById']('rep-preview-area')['style']['display']='block';},'saveReport':async()=>{const I=document['getElementById']('rep-name')['value'];if(!I)return alert('Dê\x20um\x20nome\x20ao\x20relatório');const d={'id':Date['now'](),'name':I,'source':document['getElementById']('rep-source')['value'],'start':document['getElementById']('rep-start')['value'],'end':document['getElementById']('rep-end')['value'],'createdAt':new Date()};await db['put']('customReports',d),document['getElementById']('custom-report-modal')['style']['display']='none',reportManager['loadSaved']();},'renderCharts':async()=>{const I=await db['getAll']('transactions'),d={};I['forEach'](P=>{const U=P['date']['substring'](0x0,0x7);if(!d[U])d[U]=0x0;if(P['type']==='in'&&P['status']==='paid')d[U]+=P['value'];});const e=Object['keys'](d)['sort']()['slice'](-0x6);let M='';const L=Math['max'](...Object['values'](d))||0x1;e['forEach'](P=>{const U=d[P]/L*0x64;M+='<div\x20class=\x22chart-bar-group\x22><div\x20class=\x22chart-bar\x20c-success\x22\x20style=\x22height:\x20'+U+'%\x22><span\x20class=\x22chart-val-tooltip\x22>R$\x20'+d[P]+'</span></div><span\x20class=\x22chart-label\x22>'+P['split']('-')[0x1]+'</span></div>';}),document['getElementById']('chart-revenue')['innerHTML']=M||'<small>Sem\x20dados</small>';const b=await db['getAll']('contacts'),v={};b['forEach'](P=>{v[P['type']]=(v[P['type']]||0x0)+0x1;});let B='';const T=b['length']||0x1;Object['keys'](v)['forEach'](P=>{const U=v[P]/T*0x64;B+='<div\x20class=\x22chart-bar-group\x22><div\x20class=\x22chart-bar\x20c-primary\x22\x20style=\x22height:\x20'+U+'%\x22><span\x20class=\x22chart-val-tooltip\x22>'+v[P]+'</span></div><span\x20class=\x22chart-label\x22>'+P['substring'](0x0,0x6)+'</span></div>';}),document['getElementById']('chart-clients')['innerHTML']=B||'<small>Sem\x20dados</small>';const N=await db['getAll']('albums');let z='<div\x20class=\x22chart-bar-group\x22><div\x20class=\x22chart-bar\x20c-warning\x22\x20style=\x22height:\x2050%\x22><span\x20class=\x22chart-val-tooltip\x22>'+N['length']+'</span></div><span\x20class=\x22chart-label\x22>Ativos</span></div>';document['getElementById']('chart-projects')['innerHTML']=z;}},financeManager={'transactions':[],'init':async()=>{const I=new Date(),d=String(I['getMonth']()+0x1)['padStart'](0x2,'0'),e=I['getFullYear']();document['getElementById']('fin-filter-month')['value']=e+'-'+d;},'openDashboard':async()=>{document['getElementById']('financial-dashboard-modal')['style']['display']='flex',await financeManager['render']();},'openForm':()=>{document['getElementById']('fin-form')['reset'](),financeManager['updateCategories'](),document['getElementById']('financial-form-modal')['style']['display']='flex';},'updateCategories':()=>{const I=document['getElementById']('fin-type')['value'],d=document['getElementById']('fin-cat');d['innerHTML']='';const e=['Venda\x20de\x20Serviço','Venda\x20de\x20Produto','Adiantamento','Outras\x20Receitas'],M=['Aluguel','Fornecedores','Material','Marketing','Impostos','Salários','Software','Outras\x20Despesas'],L=I==='in'?e:M;L['forEach'](b=>d['innerHTML']+='<option\x20value=\x22'+b+'\x22>'+b+'</option>');},'save':async I=>{I['preventDefault']();const d={'id':Date['now'](),'type':document['getElementById']('fin-type')['value'],'desc':document['getElementById']('fin-desc')['value'],'category':document['getElementById']('fin-cat')['value'],'value':parseFloat(document['getElementById']('fin-value')['value']),'date':document['getElementById']('fin-date')['value'],'status':document['getElementById']('fin-status')['value']};await db['put']('transactions',d),document['getElementById']('financial-form-modal')['style']['display']='none',financeManager['render']();},'render':async()=>{const I=await db['getAll']('transactions'),d=document['getElementById']('fin-filter-month')['value'],e=document['getElementById']('fin-filter-type')['value'];let M=I;if(d)M=M['filter'](z=>z['date']['startsWith'](d));if(e!=='all')M=M['filter'](z=>z['type']===e);M['sort']((z,P)=>P['date']['localeCompare'](z['date']));let L=0x0,b=0x0;const v=document['getElementById']('fin-list-body');v['innerHTML']='';if(M['length']===0x0)v['innerHTML']='<tr><td\x20colspan=\x227\x22\x20style=\x22text-align:center;\x20padding:30px;\x20color:#64748b;\x22>Nenhum\x20lançamento\x20encontrado.</td></tr>';M['forEach'](z=>{if(z['type']==='in'&&z['status']==='paid')L+=z['value'];if(z['type']==='out'&&z['status']==='paid')b+=z['value'];const P=z['type']==='in'?'<div\x20class=\x22fin-type-icon\x20type-in\x22><i\x20class=\x22fas\x20fa-arrow-up\x22></i></div>':'<div\x20class=\x22fin-type-icon\x20type-out\x22><i\x20class=\x22fas\x20fa-arrow-down\x22></i></div>';let U='';const k=new Date()['toISOString']()['split']('T')[0x0];if(z['status']==='paid')U=z['type']==='in'?'<span\x20class=\x22status-badge\x20received\x22>Recebido</span>':'<span\x20class=\x22status-badge\x20paid\x22>Pago</span>';else{if(z['date']<k)U='<span\x20class=\x22status-badge\x20late\x22>Atrasado</span>';else U='<span\x20class=\x22status-badge\x20pending-pay\x22>Pendente</span>';}let W='';if(z['eventId'])W='<span\x20class=\x22fin-auto-badge\x22\x20title=\x22Lançamento\x20automático\x20via\x20Agenda\x22><i\x20class=\x22fas\x20fa-link\x22></i>\x20Auto</span>';v['innerHTML']+='<tr><td>'+P+'</td><td\x20style=\x22font-weight:600;\x22>'+z['desc']+'<div>'+W+'</div></td><td\x20style=\x22color:#64748b;\x20font-size:0.85rem;\x22>'+z['category']+'</td><td>'+new Date(z['date'])['toLocaleDateString']('pt-BR',{'timeZone':'UTC'})+'</td><td\x20style=\x22font-weight:700;\x20color:\x20'+(z['type']==='in'?'#166534':'#ef4444')+'\x22>R$\x20'+z['value']['toFixed'](0x2)+'</td><td>'+U+'</td><td\x20style=\x22text-align:right;\x22>'+(z['status']==='pending'?'<button\x20class=\x22btn\x20btn-sm\x20btn-outline\x22\x20title=\x22Marcar\x20Pago\x22\x20onclick=\x22financeManager.markPaid('+z['id']+')\x22><i\x20class=\x22fas\x20fa-check\x22></i></button>':'')+'\x20<button\x20class=\x22btn\x20btn-sm\x20btn-danger-outline\x22\x20onclick=\x22financeManager.delete('+z['id']+')\x22><i\x20class=\x22fas\x20fa-trash\x22></i></button></td></tr>';});const B=L-b;document['getElementById']('bi-income')['innerText']=L['toLocaleString']('pt-BR',{'style':'currency','currency':'BRL'}),document['getElementById']('bi-expense')['innerText']=b['toLocaleString']('pt-BR',{'style':'currency','currency':'BRL'}),document['getElementById']('bi-balance')['innerText']=B['toLocaleString']('pt-BR',{'style':'currency','currency':'BRL'}),document['getElementById']('bi-balance')['style']['color']=B>=0x0?'#1e293b':'#ef4444',document['getElementById']('bi-balance-txt')['innerHTML']=B>=0x0?'<i\x20class=\x22fas\x20fa-smile\x22\x20style=\x22color:#10b981\x22></i>\x20Resultado\x20Positivo':'<i\x20class=\x22fas\x20fa-frown\x22\x20style=\x22color:#ef4444\x22></i>\x20Prejuízo\x20no\x20Período';const T=Math['max'](L,b)||0x1;document['getElementById']('bi-bar-income')['style']['width']=L/T*0x64+'%',document['getElementById']('bi-bar-expense')['style']['width']=b/T*0x64+'%';let N=L>0x0?B/L*0x64:0x0;if(N<0x0)N=0x0;document['getElementById']('bi-bar-balance')['style']['width']=N+'%',mgmt['updateDRE'](L,b);},'markPaid':async I=>{const d=await db['getAll']('transactions'),e=d['find'](M=>M['id']===I);e&&(e['status']='paid',await db['put']('transactions',e),financeManager['render']());},'delete':async I=>{confirm('Excluir\x20este\x20lançamento?')&&(await db['delete']('transactions',I),financeManager['render']());}},mgmt={'switch':I=>{document['querySelectorAll']('.mgmt-nav\x20button')['forEach'](e=>e['classList']['remove']('active')),event['currentTarget']['classList']['add']('active'),document['querySelectorAll']('.mgmt-section')['forEach'](e=>e['classList']['remove']('active'));const d=document['getElementById']('mgmt-'+I);if(d)d['classList']['add']('active');if(I==='stock')stockManager['load']();if(I==='albums')albumManager['load']();if(I==='opps')oppManager['load']();if(I==='reports')reportManager['init']();},'updateDRE':(I,d)=>{const e=I,M=e*0.06,L=e-M,b=d*0.4,v=L-b,B=d*0.6,T=v-B,N=P=>P['toLocaleString']('pt-BR',{'style':'currency','currency':'BRL'});document['getElementById']('dre-receita')['innerText']=N(e),document['getElementById']('dre-impostos')['innerText']='('+N(M)+')',document['getElementById']('dre-rec-liq')['innerText']=N(L),document['getElementById']('dre-custos')['innerText']='('+N(b)+')',document['getElementById']('dre-lucro-bruto')['innerText']=N(v),document['getElementById']('dre-despesas')['innerText']='('+N(B)+')',document['getElementById']('dre-resultado')['innerText']=N(T);const z=document['getElementById']('dre-resultado');T<0x0?z['style']['color']='red':z['style']['color']='#166534';}},dashboardManager={'widgets':[{'id':'dash-card-calls','name':'Atendimentos\x20do\x20Dia','icon':'fas\x20fa-headset'},{'id':'dash-card-albums','name':'Projetos\x20Ativos','icon':'fas\x20fa-tasks'},{'id':'dash-card-revenue','name':'Faturamento\x20Mensal','icon':'fas\x20fa-wallet'},{'id':'dash-card-calendar','name':'Calendário\x20Principal','icon':'far\x20fa-calendar-alt'},{'id':'dash-card-events','name':'Lista\x20de\x20Eventos','icon':'fas\x20fa-list-ul'}],'settings':['dash-card-calls','dash-card-albums','dash-card-revenue','dash-card-calendar','dash-card-events'],'init':()=>{const I=localStorage['getItem']('dashboardSettings');I&&(dashboardManager['settings']=JSON['parse'](I)),dashboardManager['applySettings']();},'applySettings':()=>{dashboardManager['widgets']['forEach'](I=>{const d=document['getElementById'](I['id']);d&&(dashboardManager['settings']['includes'](I['id'])?d['style']['display']='block':d['style']['display']='none');});},'openModal':()=>{const I=document['getElementById']('customizer-grid-container');I['innerHTML']='',dashboardManager['widgets']['forEach'](d=>{const e=dashboardManager['settings']['includes'](d['id'])?'selected':'';I['innerHTML']+='<div\x20class=\x22customizer-item\x20'+e+'\x22\x20onclick=\x22dashboardManager.toggleItem(\x27'+d['id']+'\x27,\x20this)\x22><div\x20class=\x22check-badge\x22><i\x20class=\x22fas\x20fa-check\x22></i></div><i\x20class=\x22'+d['icon']+'\x22></i><span>'+d['name']+'</span></div>';}),document['getElementById']('dashboard-customizer-modal')['style']['display']='flex';},'closeModal':()=>{document['getElementById']('dashboard-customizer-modal')['style']['display']='none';},'toggleItem':(I,d)=>{d['classList']['toggle']('selected');},'saveSettings':()=>{const I=[],d=document['querySelectorAll']('.customizer-item');d['forEach']((e,M)=>{e['classList']['contains']('selected')&&I['push'](dashboardManager['widgets'][M]['id']);}),dashboardManager['settings']=I,localStorage['setItem']('dashboardSettings',JSON['stringify'](I)),dashboardManager['applySettings'](),dashboardManager['closeModal']();},'resetDefaults':()=>{const I=document['querySelectorAll']('.customizer-item');I['forEach'](d=>d['classList']['add']('selected'));}},agendaManager={'currentDate':new Date(),'events':[],'types':[],'visits':[],'init':async()=>{await agendaManager['loadSettings'](),agendaManager['render']();},'loadSettings':async()=>{const I=await db['getAll']('eventTypes');agendaManager['types']=I['length']?I:[{'id':0x1,'name':'Reunião','color':'#2563eb'},{'id':0x2,'name':'Instalação','color':'#166534'},{'id':0x3,'name':'Entrega','color':'#f59e0b'}];if(!I['length'])agendaManager['types']['forEach'](async e=>await db['put']('eventTypes',e));const d=await db['getAll']('visitTypes');agendaManager['visits']=d['length']?d:[{'id':0x1,'name':'Presencial'},{'id':0x2,'name':'Online\x20/\x20Remoto'}];if(!d['length'])agendaManager['visits']['forEach'](async e=>await db['put']('visitTypes',e));},'changeMonth':I=>{if(I===0x0)agendaManager['currentDate']=new Date();else agendaManager['currentDate']['setMonth'](agendaManager['currentDate']['getMonth']()+I);agendaManager['render']();},'render':async()=>{agendaManager['events']=await db['getAll']('events');const I=agendaManager['currentDate'],d=I['getFullYear'](),e=I['getMonth'](),M=['Janeiro','Fevereiro','Março','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'];document['getElementById']('agenda-month-year')['innerText']=M[e]+'\x20'+d;const L=new Date(d,e,0x1),b=new Date(d,e+0x1,0x0),v=L['getDay'](),B=b['getDate'](),T=new Date(d,e,0x0)['getDate']();let N='';for(let k=v;k>0x0;k--){N+='<div\x20class=\x22cal-cell\x20other-month\x22><span\x20class=\x22cal-cell-num\x22>'+(T-k+0x1)+'</span></div>';}const z=new Date();for(let W=0x1;W<=B;W++){const V=d+'-'+String(e+0x1)['padStart'](0x2,'0')+'-'+String(W)['padStart'](0x2,'0');let G=W===z['getDate']()&&e===z['getMonth']()&&d===z['getFullYear']()?'today':'';const Q=agendaManager['events']['filter'](l=>l['date']===V);let R='';Q['forEach'](l=>{const x=agendaManager['types']['find'](a=>a['id']==l['typeId'])||{'color':'#ccc'};R+='<div\x20class=\x22agenda-event-pill\x22\x20style=\x22background:'+x['color']+'\x22\x20onclick=\x22agendaManager.viewEvent('+l['id']+')\x22>'+l['time']+'\x20'+l['title']+'</div>';}),N+='<div\x20class=\x22cal-cell\x20'+G+'\x22\x20onclick=\x22agendaManager.dayClick(\x27'+V+'\x27)\x22><span\x20class=\x22cal-cell-num\x22>'+W+'</span><div\x20style=\x22display:flex;\x20flex-direction:column;\x20gap:2px;\x22>'+R+'</div></div>';}const P=v+B,U=0x2a-P;if(U<0x7){for(let l=0x1;l<=U;l++)N+='<div\x20class=\x22cal-cell\x20other-month\x22><span\x20class=\x22cal-cell-num\x22>'+l+'</span></div>';}document['getElementById']('agenda-grid')['innerHTML']=N,agendaManager['renderSidebarList']();},'renderSidebarList':()=>{const I=document['getElementById']('agenda-sidebar-list');I['innerHTML']='';const d=new Date()['toISOString']()['split']('T')[0x0],e=agendaManager['events']['filter'](M=>M['date']>=d)['sort']((M,L)=>(M['date']+M['time'])['localeCompare'](L['date']+L['time']))['slice'](0x0,0xa);if(!e['length']){I['innerHTML']='<p\x20style=\x22color:#94a3b8;\x20font-size:0.8rem;\x20text-align:center;\x22>Sem\x20eventos\x20próximos.</p>';return;}e['forEach'](M=>{const L=agendaManager['types']['find'](v=>v['id']==M['typeId'])||{'color':'#ccc'},b=new Date(M['date'])['toLocaleDateString']('pt-BR',{'day':'2-digit','month':'2-digit'});I['innerHTML']+='<div\x20class=\x22mini-list-item\x22><div\x20class=\x22mini-time\x22>'+b+'<br>'+M['time']+'</div><div\x20class=\x22mini-desc\x22><h4>'+M['title']+'</h4><p>'+(M['clientName']||'Sem\x20cliente')+'</p><span\x20class=\x22mini-tag\x22\x20style=\x22background:'+L['color']+'\x22></span></div></div>';});},'openModal':async(I=null)=>{document['getElementById']('event-form')['reset'](),document['getElementById']('evt-id')['value']='',document['getElementById']('evt-modal-title')['innerText']='Novo\x20Agendamento',document['getElementById']('btn-delete-event')['style']['display']='none';if(I)document['getElementById']('evt-date')['value']=I;else document['getElementById']('evt-date')['value']=new Date()['toISOString']()['split']('T')[0x0];const d=await db['getAll']('contacts'),e=document['getElementById']('evt-client');e['innerHTML']='<option\x20value=\x22\x22>Selecione\x20um\x20cliente...</option>',d['forEach'](b=>e['innerHTML']+='<option\x20value=\x22'+b['id']+'\x22>'+b['name']+'</option>');const M=document['getElementById']('evt-type');M['innerHTML']='',agendaManager['types']['forEach'](b=>M['innerHTML']+='<option\x20value=\x22'+b['id']+'\x22>'+b['name']+'</option>');const L=document['getElementById']('evt-visit-type');L['innerHTML']='',agendaManager['visits']['forEach'](b=>L['innerHTML']+='<option\x20value=\x22'+b['id']+'\x22>'+b['name']+'</option>'),document['getElementById']('event-modal')['style']['display']='flex';},'populateClientData':async()=>{const I=document['getElementById']('evt-client')['value'];if(I){const d=await db['getAll']('contacts'),e=d['find'](M=>M['id']==I);if(e&&e['address']){const M=e['address']+',\x20'+(e['number']||'')+'\x20-\x20'+(e['district']||'')+',\x20'+(e['city']||'');document['getElementById']('evt-address')['value']=M;}}},'calcFinancials':()=>{const I=parseFloat(document['getElementById']('evt-val-total')['value']||0x0),d=parseFloat(document['getElementById']('evt-val-signal')['value']||0x0),e=I-d;document['getElementById']('evt-val-rest')['value']=e['toFixed'](0x2);},'dayClick':I=>{agendaManager['openModal'](I);},'saveEvent':async I=>{I['preventDefault']();const d=document['getElementById']('evt-id')['value'],M=document['getElementById']('evt-client')['value'],L=M?document['getElementById']('evt-client')['options'][document['getElementById']('evt-client')['selectedIndex']]['text']:'',b={'id':d?parseInt(d):Date['now'](),'title':document['getElementById']('evt-title')['value'],'clientId':M,'clientName':L,'address':document['getElementById']('evt-address')['value'],'typeId':document['getElementById']('evt-type')['value'],'visitTypeId':document['getElementById']('evt-visit-type')['value'],'date':document['getElementById']('evt-date')['value'],'time':document['getElementById']('evt-time')['value'],'valTotal':document['getElementById']('evt-val-total')['value'],'valSignal':document['getElementById']('evt-val-signal')['value'],'valRest':document['getElementById']('evt-val-rest')['value'],'notes':document['getElementById']('evt-notes')['value']};await db['put']('events',b),await agendaManager['syncFinancials'](b),document['getElementById']('event-modal')['style']['display']='none',agendaManager['render'](),calendarManager['render']();},'syncFinancials':async I=>{const d=await db['getAll']('transactions'),e=d['filter'](L=>L['eventId']===I['id']);for(let L of e){await db['delete']('transactions',L['id']);}const M=new Date()['toISOString']()['split']('T')[0x0];if(parseFloat(I['valSignal'])>0x0){const b={'id':Date['now'](),'eventId':I['id'],'type':'in','desc':'Sinal:\x20'+I['title']+'\x20-\x20'+I['clientName'],'category':'Venda\x20de\x20Serviço','value':parseFloat(I['valSignal']),'date':M,'status':'paid'};await db['put']('transactions',b);}if(parseFloat(I['valRest'])>0x0){const v={'id':Date['now']()+0x1,'eventId':I['id'],'type':'in','desc':'Restante:\x20'+I['title']+'\x20-\x20'+I['clientName'],'category':'Venda\x20de\x20Serviço','value':parseFloat(I['valRest']),'date':I['date'],'status':'pending'};await db['put']('transactions',v);}},'deleteEvent':async()=>{const I=document['getElementById']('evt-id')['value'];if(I&&confirm('Tem\x20certeza?\x20Os\x20dados\x20financeiros\x20vinculados\x20também\x20serão\x20removidos.')){const d=parseInt(I);await db['delete']('events',d);const e=await db['getAll']('transactions'),M=e['filter'](L=>L['eventId']===d);for(let L of M){await db['delete']('transactions',L['id']);}document['getElementById']('event-modal')['style']['display']='none',agendaManager['render'](),calendarManager['render']();}},'viewEvent':async I=>{const d=agendaManager['events']['find'](e=>e['id']===I);d&&(await agendaManager['openModal'](),document['getElementById']('evt-modal-title')['innerText']='Editar\x20Agendamento',document['getElementById']('btn-delete-event')['style']['display']='block',document['getElementById']('evt-id')['value']=d['id'],document['getElementById']('evt-title')['value']=d['title'],document['getElementById']('evt-client')['value']=d['clientId']||'',document['getElementById']('evt-address')['value']=d['address']||'',document['getElementById']('evt-type')['value']=d['typeId'],document['getElementById']('evt-visit-type')['value']=d['visitTypeId'],document['getElementById']('evt-date')['value']=d['date'],document['getElementById']('evt-time')['value']=d['time'],document['getElementById']('evt-val-total')['value']=d['valTotal']||'',document['getElementById']('evt-val-signal')['value']=d['valSignal']||'',document['getElementById']('evt-val-rest')['value']=d['valRest']||'',document['getElementById']('evt-notes')['value']=d['notes']);},'openSettings':async()=>{await agendaManager['renderSettingsLists'](),document['getElementById']('agenda-settings-modal')['style']['display']='flex';},'switchSettingsTab':I=>{document['querySelectorAll']('.modal-tab-btn')['forEach'](d=>d['classList']['remove']('active')),event['currentTarget']['classList']['add']('active'),document['querySelectorAll']('#agenda-settings-modal\x20.inner-tab')['forEach'](d=>d['classList']['remove']('active')),document['getElementById']('set-tab-'+I)['classList']['add']('active');},'renderSettingsLists':async()=>{const I=document['getElementById']('agenda-types-list');I['innerHTML']='',agendaManager['types']['forEach'](e=>{I['innerHTML']+='<tr><td>'+e['name']+'</td><td><div\x20style=\x22width:20px;height:20px;background:'+e['color']+';border-radius:4px;\x22></div></td><td><button\x20class=\x22btn\x20btn-sm\x20btn-danger-outline\x22\x20onclick=\x22agendaManager.delType('+e['id']+')\x22><i\x20class=\x22fas\x20fa-trash\x22></i></button></td></tr>';});const d=document['getElementById']('agenda-visits-list');d['innerHTML']='',agendaManager['visits']['forEach'](e=>{d['innerHTML']+='<tr><td>'+e['name']+'</td><td><button\x20class=\x22btn\x20btn-sm\x20btn-danger-outline\x22\x20onclick=\x22agendaManager.delVisit('+e['id']+')\x22><i\x20class=\x22fas\x20fa-trash\x22></i></button></td></tr>';});},'addType':async()=>{const I=document['getElementById']('new-type-name')['value'],d=document['getElementById']('new-type-color')['value'];I&&(await db['put']('eventTypes',{'id':Date['now'](),'name':I,'color':d}),document['getElementById']('new-type-name')['value']='',await agendaManager['loadSettings'](),agendaManager['renderSettingsLists'](),agendaManager['render']());},'delType':async I=>{confirm('Remover\x20este\x20tipo?')&&(await db['delete']('eventTypes',I),await agendaManager['loadSettings'](),agendaManager['renderSettingsLists']());},'addVisitType':async()=>{const I=document['getElementById']('new-visit-name')['value'];I&&(await db['put']('visitTypes',{'id':Date['now'](),'name':I}),document['getElementById']('new-visit-name')['value']='',await agendaManager['loadSettings'](),agendaManager['renderSettingsLists']());},'delVisit':async I=>{confirm('Remover\x20este\x20tipo\x20de\x20visita?')&&(await db['delete']('visitTypes',I),await agendaManager['loadSettings'](),agendaManager['renderSettingsLists']());}},msgManager={'templates':[{'id':0x1,'title':'Boas\x20Vindas','text':'Olá\x20[Nome],\x20seja\x20bem-vindo\x20à\x20Legacy!\x20Como\x20podemos\x20ajudar?'},{'id':0x2,'title':'Confirmação\x20Agenda','text':'Olá\x20[Nome],\x20confirmando\x20nosso\x20agendamento\x20para\x20[Data]\x20às\x20[Hora].\x20O\x20endereço\x20é\x20[Endereco].'},{'id':0x3,'title':'Cobrança\x20Financeira','text':'Olá\x20[Nome],\x20segue\x20lembrete\x20sobre\x20o\x20pagamento\x20restante\x20de\x20R$\x20[Restante]\x20referente\x20ao\x20serviço\x20total\x20de\x20R$\x20[Total].'}],'contacts':[],'viewMode':'contacts','activeChatContact':null,'init':()=>{const I=localStorage['getItem']('waTemplates');if(I)msgManager['templates']=JSON['parse'](I);},'openModal':async()=>{document['getElementById']('whatsapp-modal')['style']['display']='flex',msgManager['contacts']=await db['getAll']('contacts'),msgManager['switchView']('contacts');},'switchView':I=>{msgManager['viewMode']=I,document['getElementById']('btn-wa-view-contacts')['classList']['toggle']('active',I==='contacts'),document['getElementById']('btn-wa-view-templates')['classList']['toggle']('active',I==='templates'),document['getElementById']('wa-view-chat')['style']['display']='flex',document['getElementById']('wa-view-new-template')['style']['display']='none',msgManager['renderList']();},'renderList':()=>{const I=document['getElementById']('wa-list-container');I['innerHTML']='';const d=document['getElementById']('wa-search-input')['value']['toLowerCase']();if(msgManager['viewMode']==='contacts'){const e=msgManager['contacts']['filter'](M=>M['name']['toLowerCase']()['includes'](d)||M['phone']&&M['phone']['includes'](d));if(e['length']===0x0){I['innerHTML']='<div\x20style=\x22padding:15px;\x20color:#999;\x20text-align:center;\x22>Nenhum\x20contato\x20encontrado.</div>';return;}e['forEach'](M=>{const L=msgManager['activeChatContact']&&msgManager['activeChatContact']['id']===M['id']?'active':'';I['innerHTML']+='<div\x20class=\x22wa-list-item\x20'+L+'\x22\x20onclick=\x22msgManager.selectContact('+M['id']+')\x22><div\x20class=\x22wa-avatar\x22><i\x20class=\x22fas\x20fa-user\x22></i></div><div\x20style=\x22flex:1;\x22><div\x20style=\x22font-weight:600;\x20font-size:0.9rem;\x22>'+M['name']+'</div><div\x20style=\x22font-size:0.8rem;\x20color:#667781;\x22>'+(M['phone']||'Sem\x20telefone')+'</div></div></div>';});}else{const M=msgManager['templates']['filter'](L=>L['title']['toLowerCase']()['includes'](d));I['innerHTML']+='<div\x20style=\x22padding:10px;\x20text-align:center;\x20border-bottom:1px\x20solid\x20#f1f5f9;\x22><button\x20class=\x22btn\x20btn-sm\x20btn-primary\x22\x20onclick=\x22msgManager.openTemplateEditor()\x22>+\x20Novo\x20Modelo</button></div>',M['forEach'](L=>{I['innerHTML']+='<div\x20class=\x22wa-list-item\x22\x20onclick=\x22msgManager.selectTemplate(\x27'+L['id']+'\x27)\x22><div\x20class=\x22wa-avatar\x22\x20style=\x22background:#f0f2f5;\x20color:#54656f;\x20font-size:1rem;\x22><i\x20class=\x22fas\x20fa-file-alt\x22></i></div><div\x20style=\x22flex:1;\x22><div\x20style=\x22font-weight:600;\x20font-size:0.9rem;\x22>'+L['title']+'</div><div\x20style=\x22font-size:0.8rem;\x20color:#667781;\x20white-space:nowrap;\x20overflow:hidden;\x20text-overflow:ellipsis;\x20max-width:140px;\x22>'+L['text']+'</div></div><i\x20class=\x22fas\x20fa-pencil-alt\x20wa-list-action-btn\x22\x20title=\x22Editar\x22\x20onclick=\x22event.stopPropagation();\x20msgManager.editTemplate('+L['id']+')\x22></i><i\x20class=\x22fas\x20fa-trash\x20wa-list-action-btn\x22\x20title=\x22Excluir\x22\x20onclick=\x22event.stopPropagation();\x20msgManager.deleteTemplate('+L['id']+')\x22></i></div>';});}},'search':()=>{msgManager['renderList']();},'selectContact':I=>{const d=msgManager['contacts']['find'](e=>e['id']===I);d&&(msgManager['activeChatContact']=d,document['getElementById']('wa-chat-name')['innerText']=d['name'],document['getElementById']('wa-chat-phone')['innerText']=d['phone']||'Sem\x20telefone\x20registrado',document['getElementById']('wa-view-chat')['style']['display']='flex',document['getElementById']('wa-view-new-template')['style']['display']='none',msgManager['renderList']());},'openTemplateEditor':()=>{document['getElementById']('wa-view-chat')['style']['display']='none',document['getElementById']('wa-view-new-template')['style']['display']='flex',document['getElementById']('tpl-editor-title')['innerText']='Novo\x20Modelo',document['getElementById']('tpl-edit-id')['value']='',document['getElementById']('tpl-new-title')['value']='',document['getElementById']('tpl-new-text')['value']='';},'editTemplate':I=>{const d=msgManager['templates']['find'](e=>e['id']==I);if(!d)return;document['getElementById']('wa-view-chat')['style']['display']='none',document['getElementById']('wa-view-new-template')['style']['display']='flex',document['getElementById']('tpl-editor-title')['innerText']='Editar\x20Modelo',document['getElementById']('tpl-edit-id')['value']=d['id'],document['getElementById']('tpl-new-title')['value']=d['title'],document['getElementById']('tpl-new-text')['value']=d['text'];},'cancelTemplateCreation':()=>{document['getElementById']('wa-view-chat')['style']['display']='flex',document['getElementById']('wa-view-new-template')['style']['display']='none';},'deleteTemplate':I=>{confirm('Excluir\x20este\x20modelo?')&&(msgManager['templates']=msgManager['templates']['filter'](d=>d['id']!=I),localStorage['setItem']('waTemplates',JSON['stringify'](msgManager['templates'])),msgManager['renderList']());},'insertVar':I=>{const d=document['getElementById']('tpl-new-text'),e='['+I+']',M=d['selectionStart'],L=d['selectionEnd'];d['value']=d['value']['substring'](0x0,M)+e+d['value']['substring'](L,d['value']['length']),d['focus'](),d['selectionStart']=M+e['length'],d['selectionEnd']=M+e['length'];},'saveNewTemplate':()=>{const I=document['getElementById']('tpl-edit-id')['value'],d=document['getElementById']('tpl-new-title')['value'],e=document['getElementById']('tpl-new-text')['value'];if(!d||!e)return alert('Preencha\x20título\x20e\x20conteúdo.');if(I){const M=msgManager['templates']['find'](L=>L['id']==I);M&&(M['title']=d,M['text']=e);}else msgManager['templates']['push']({'id':Date['now'](),'title':d,'text':e});localStorage['setItem']('waTemplates',JSON['stringify'](msgManager['templates'])),msgManager['cancelTemplateCreation'](),msgManager['renderList']();},'getNextEventData':async I=>{if(!I)return null;const d=await db['getAll']('events'),e=new Date()['toISOString']()['split']('T')[0x0],M=d['filter'](L=>L['clientId']==I&&L['date']>=e);return M['sort']((L,v)=>{if(L['date']===v['date'])return L['time']['localeCompare'](v['time']);return L['date']['localeCompare'](v['date']);}),M['length']>0x0?M[0x0]:null;},'selectTemplate':async I=>{const d=msgManager['templates']['find'](e=>e['id']==I);if(d){let e=d['text'];if(msgManager['activeChatContact']){e=e['replaceAll']('[Nome]',msgManager['activeChatContact']['name']['split']('\x20')[0x0]),e=e['replaceAll']('[Telefone]',msgManager['activeChatContact']['phone']||''),e=e['replaceAll']('[Empresa]','RC\x20Sistemas');const M=await msgManager['getNextEventData'](msgManager['activeChatContact']['id']);if(M){const L=new Date(M['date'])['toLocaleDateString']('pt-BR');e=e['replaceAll']('[Data]',L),e=e['replaceAll']('[Hora]',M['time']),e=e['replaceAll']('[Endereco]',M['address']||'Endereço\x20não\x20informado');const b=parseFloat(M['valTotal']||0x0)['toLocaleString']('pt-BR',{'minimumFractionDigits':0x2}),v=parseFloat(M['valSignal']||0x0)['toLocaleString']('pt-BR',{'minimumFractionDigits':0x2}),B=parseFloat(M['valRest']||0x0)['toLocaleString']('pt-BR',{'minimumFractionDigits':0x2});e=e['replaceAll']('[Total]',b),e=e['replaceAll']('[Sinal]',v),e=e['replaceAll']('[Restante]',B);}else e=e['replaceAll']('[Data]','(Data?)'),e=e['replaceAll']('[Hora]','(Hora?)'),e=e['replaceAll']('[Endereco]','(Endereço?)'),e=e['replaceAll']('[Total]','0,00'),e=e['replaceAll']('[Sinal]','0,00'),e=e['replaceAll']('[Restante]','0,00');}document['getElementById']('wa-input-msg')['value']=e,msgManager['checkInput'](),document['getElementById']('wa-view-chat')['style']['display']='flex',document['getElementById']('wa-view-new-template')['style']['display']='none';}},'checkInput':()=>{const I=document['getElementById']('wa-input-msg')['value'],d=document['getElementById']('wa-btn-send');if(I['trim']()['length']>0x0)d['classList']['add']('ready');else d['classList']['remove']('ready');},'sendMessage':()=>{const I=document['getElementById']('wa-input-msg')['value'];if(!I)return;let d='';msgManager['activeChatContact']&&msgManager['activeChatContact']['phone']?d=msgManager['activeChatContact']['phone']:d=prompt('Digite\x20o\x20número\x20do\x20WhatsApp:','');if(d){const e=d['replace'](/\D/g,'');window['open']('https://wa.me/55'+e+'?text='+encodeURIComponent(I),'_blank');const M=document['getElementById']('wa-chat-body');M['innerHTML']+='<div\x20class=\x22wa-msg\x20sent\x22>'+I+'<span\x20class=\x22wa-msg-meta\x22>'+new Date()['toLocaleTimeString']([],{'hour':'2-digit','minute':'2-digit'})+'\x20<i\x20class=\x22fas\x20fa-check\x22></i></span></div>',document['getElementById']('wa-input-msg')['value']='',M['scrollTop']=M['scrollHeight'];}else alert('Telefone\x20inválido.');}},calendarManager={'currentDate':new Date(),'init':()=>{calendarManager['render']();},'changeMonth':I=>{if(I===0x0)calendarManager['currentDate']=new Date();else calendarManager['currentDate']['setMonth'](calendarManager['currentDate']['getMonth']()+I);calendarManager['render']();},'render':async()=>{const I=await db['getAll']('events'),d=await db['getAll']('eventTypes'),e=calendarManager['currentDate'],M=e['getFullYear'](),L=e['getMonth'](),b=['Janeiro','Fevereiro','Março','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'];document['getElementById']('cal-month-year')['innerText']=b[L]+'\x20'+M;const v=new Date(M,L,0x1),B=new Date(M,L+0x1,0x0),T=v['getDay'](),N=B['getDate'](),z=new Date(M,L,0x0)['getDate']();let P='';for(let V=T;V>0x0;V--)P+='<div\x20class=\x22cal-cell\x20other-month\x22><span\x20class=\x22cal-cell-num\x22>'+(z-V+0x1)+'</span></div>';const U=new Date();for(let G=0x1;G<=N;G++){let Q=G===U['getDate']()&&L===U['getMonth']()&&M===U['getFullYear']()?'today':'';const R=M+'-'+String(L+0x1)['padStart'](0x2,'0')+'-'+String(G)['padStart'](0x2,'0'),l=I['filter'](a=>a['date']===R);let x='';l['length']>0x0&&(x='<div\x20style=\x22margin-top:5px;\x22>',l['forEach'](a=>{const y=d['find'](Z=>Z['id']==a['typeId'])||{'color':'#ccc'};x+='<span\x20class=\x22cal-event-dot\x22\x20style=\x22background:'+y['color']+'\x22></span>';}),x+='</div>'),P+='<div\x20class=\x22cal-cell\x20'+Q+'\x22><span\x20class=\x22cal-cell-num\x22>'+G+'</span>'+x+'</div>';}const k=T+N,W=0x2a-k;if(W<0x7){for(let a=0x1;a<=W;a++)P+='<div\x20class=\x22cal-cell\x20other-month\x22><span\x20class=\x22cal-cell-num\x22>'+a+'</span></div>';}document['getElementById']('calendar-grid')['innerHTML']=P,calendarManager['updateHomeWidget'](I);},'updateHomeWidget':I=>{const d=document['getElementById']('home-agenda-widget'),e=new Date()['toISOString']()['split']('T')[0x0],M=I['filter'](L=>L['date']>=e)['sort']((L,v)=>L['date']['localeCompare'](v['date']))['slice'](0x0,0x5);M['length']===0x0?d['innerHTML']='<div\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20align-items:\x20center;\x20justify-content:\x20center;\x20height:\x20150px;\x20color:\x20var(--text-muted);\x20text-align:\x20center;\x22><i\x20class=\x22far\x20fa-calendar-check\x22\x20style=\x22font-size:\x202rem;\x20margin-bottom:\x2010px;\x20opacity:\x200.3;\x22></i><p\x20style=\x22font-size:\x200.9rem;\x22>Tudo\x20limpo\x20por\x20aqui.</p></div>':(d['innerHTML']='',M['forEach'](L=>{d['innerHTML']+='<div\x20style=\x22padding:10px;\x20border-bottom:1px\x20solid\x20#f1f5f9;\x20display:flex;\x20justify-content:space-between;\x20align-items:center;\x22><div><div\x20style=\x22font-weight:600;\x20font-size:0.9rem;\x22>'+L['title']+'</div><div\x20style=\x22font-size:0.75rem;\x20color:#64748b;\x22>'+new Date(L['date'])['toLocaleDateString']()+'\x20-\x20'+L['time']+'</div></div><div\x20style=\x22font-size:0.8rem;\x20background:#eff6ff;\x20color:#2563eb;\x20padding:2px\x208px;\x20border-radius:12px;\x22>Agenda</div></div>';}));}},oppManager={'opps':[],'load':async()=>{oppManager['opps']=await db['getAll']('opps'),oppManager['render']();},'render':()=>{const I=document['getElementById']('opps-list');I['innerHTML']='';if(oppManager['opps']['length']===0x0){I['innerHTML']='<tr><td\x20colspan=\x225\x22\x20style=\x22text-align:center;\x20padding:20px;\x20color:#64748b;\x22>Nenhuma\x20oportunidade\x20registrada.</td></tr>';return;}oppManager['opps']['forEach'](d=>{const e={'Prospect':'Prospecção','Proposal':'Proposta','Negotiation':'Negociação','Closed':'Fechado','Lost':'Perdido'};I['innerHTML']+='<tr><td>'+d['title']+'</td><td>'+d['client']+'</td><td>R$\x20'+parseFloat(d['value'])['toFixed'](0x2)+'</td><td><span\x20class=\x22status-badge\x20lead\x22>'+e[d['status']]+'</span></td><td><button\x20class=\x22btn\x20btn-sm\x20btn-danger-outline\x22\x20onclick=\x22oppManager.del('+d['id']+')\x22><i\x20class=\x22fas\x20fa-trash\x22></i></button></td></tr>';});},'openModal':()=>{document['getElementById']('opp-modal')['style']['display']='flex';},'closeModal':()=>{document['getElementById']('opp-modal')['style']['display']='none';},'save':async I=>{I['preventDefault']();const d={'id':Date['now'](),'title':document['getElementById']('opp-title')['value'],'client':document['getElementById']('opp-client')['value'],'value':document['getElementById']('opp-value')['value'],'status':document['getElementById']('opp-status')['value']};await db['put']('opps',d),oppManager['load'](),oppManager['closeModal'](),document['getElementById']('opp-form')['reset']();},'del':async I=>{confirm('Deseja\x20excluir?')&&(await db['delete']('opps',I),oppManager['load']());}},stockManager={'products':[],'load':async()=>{stockManager['products']=await db['getAll']('products'),stockManager['render'](),stockManager['renderKPIs']();},'render':()=>{const I=document['getElementById']('stock-list');I['innerHTML']='';const d=document['getElementById']('stock-search')['value']['toLowerCase'](),e=stockManager['products']['filter'](M=>M['name']['toLowerCase']()['includes'](d)||M['sku']&&M['sku']['toLowerCase']()['includes'](d));if(e['length']===0x0){I['innerHTML']='<tr><td\x20colspan=\x226\x22\x20style=\x22text-align:center;\x20padding:20px;\x20color:#64748b;\x22>Nenhum\x20produto\x20no\x20estoque.</td></tr>';return;}e['forEach'](M=>{const L=parseInt(M['stock']||0x0),b=parseInt(M['minStock']||0x0);let v='<span\x20class=\x22status-badge\x20active\x22>OK</span>';if(L<=b)v='<span\x20class=\x22status-badge\x20pending\x22>Baixo</span>';if(L===0x0)v='<span\x20class=\x22status-badge\x20closed\x22>Zerado</span>';I['innerHTML']+='<tr><td><strong>'+M['name']+'</strong><br><small\x20style=\x22color:#94a3b8\x22>'+(M['sku']||'-')+'</small></td><td>'+(M['category']||'Geral')+'</td><td>'+L+'</td><td>R$\x20'+parseFloat(M['price']||0x0)['toFixed'](0x2)+'</td><td>'+v+'</td><td><button\x20class=\x22btn\x20btn-sm\x20btn-outline\x22\x20onclick=\x22stockManager.editProduct('+M['id']+')\x22><i\x20class=\x22fas\x20fa-edit\x22></i></button>\x20<button\x20class=\x22btn\x20btn-sm\x20btn-danger-outline\x22\x20onclick=\x22stockManager.deleteProduct('+M['id']+')\x22><i\x20class=\x22fas\x20fa-trash\x22></i></button></td></tr>';});},'renderKPIs':()=>{const I=stockManager['products']['length'];let d=0x0,e=0x0;stockManager['products']['forEach'](M=>{if((M['stock']||0x0)<=(M['minStock']||0x0))d++;e+=(M['stock']||0x0)*(M['cost']||0x0);}),document['getElementById']('stk-total-count')['innerText']=I,document['getElementById']('stk-low-alert')['innerText']=d,document['getElementById']('stk-valuation')['innerText']='R$\x20'+e['toFixed'](0x2);},'openProductModal':()=>{document['getElementById']('product-form')['reset'](),document['getElementById']('prod-id')['value']='',document['getElementById']('prod-modal-title')['innerText']='Novo\x20Produto',document['getElementById']('product-modal')['style']['display']='flex';},'editProduct':I=>{const d=stockManager['products']['find'](e=>e['id']===I);d&&(document['getElementById']('prod-id')['value']=d['id'],document['getElementById']('prod-name')['value']=d['name'],document['getElementById']('prod-sku')['value']=d['sku']||'',document['getElementById']('prod-category')['value']=d['category']||'',document['getElementById']('prod-cost')['value']=d['cost']||'',document['getElementById']('prod-price')['value']=d['price']||'',document['getElementById']('prod-min')['value']=d['minStock']||0x5,document['getElementById']('prod-supplier')['value']=d['supplier']||'',document['getElementById']('prod-desc')['value']=d['description']||'',document['getElementById']('prod-modal-title')['innerText']='Editar\x20Produto',document['getElementById']('product-modal')['style']['display']='flex');},'saveProduct':async I=>{I['preventDefault']();const d=document['getElementById']('prod-id')['value'];let M={};if(d){const L=stockManager['products']['find'](b=>b['id']==d);M={...L};}else M={'id':Date['now'](),'stock':0x0};M['name']=document['getElementById']('prod-name')['value'],M['sku']=document['getElementById']('prod-sku')['value'],M['category']=document['getElementById']('prod-category')['value'],M['cost']=parseFloat(document['getElementById']('prod-cost')['value']||0x0),M['price']=parseFloat(document['getElementById']('prod-price')['value']||0x0),M['minStock']=parseInt(document['getElementById']('prod-min')['value']||0x5),M['supplier']=document['getElementById']('prod-supplier')['value'],M['description']=document['getElementById']('prod-desc')['value'],await db['put']('products',M),document['getElementById']('product-modal')['style']['display']='none',stockManager['load']();},'deleteProduct':async I=>{confirm('Tem\x20certeza\x20que\x20deseja\x20excluir\x20este\x20produto?')&&(await db['delete']('products',I),stockManager['load']());},'openMovementModal':()=>{const I=document['getElementById']('mov-product');I['innerHTML']='<option\x20value=\x22\x22>Selecione...</option>',stockManager['products']['forEach'](d=>{I['innerHTML']+='<option\x20value=\x22'+d['id']+'\x22>'+d['name']+'</option>';}),document['getElementById']('movement-form')['reset'](),document['getElementById']('mov-current-stock-display')['innerText']='Saldo\x20Atual:\x20-',document['getElementById']('movement-modal')['style']['display']='flex';},'updateCurrentStockDisplay':()=>{const I=document['getElementById']('mov-product')['value'];if(I){const d=stockManager['products']['find'](e=>e['id']==I);document['getElementById']('mov-current-stock-display')['innerText']='Saldo\x20Atual:\x20'+d['stock'];}else document['getElementById']('mov-current-stock-display')['innerText']='Saldo\x20Atual:\x20-';},'saveMovement':async I=>{I['preventDefault']();const d=parseInt(document['getElementById']('mov-product')['value']),M=document['getElementById']('mov-type')['value'],L=parseInt(document['getElementById']('mov-qty')['value']),b=document['getElementById']('mov-reason')['value'];if(!d)return;const v=stockManager['products']['find'](N=>N['id']===d);let B=parseInt(v['stock']||0x0);if(M==='entry')B+=L;if(M==='exit')B-=L;if(M==='adjust')B=L;v['stock']=B,await db['put']('products',v);const T={'id':Date['now'](),'productId':d,'type':M,'qty':L,'reason':b,'date':new Date(),'stockAfter':B};await db['put']('movements',T),document['getElementById']('movement-modal')['style']['display']='none',stockManager['load']();}},contactManager={'contacts':[],'load':async()=>{contactManager['contacts']=await db['getAll']('contacts'),contactManager['render'](contactManager['contacts']);},'render':I=>{const d=document['getElementById']('contacts-list');d['innerHTML']='';if(I['length']===0x0){d['innerHTML']='<tr><td\x20colspan=\x225\x22\x20style=\x22text-align:center;\x20padding:30px;\x22>Nenhum\x20contato\x20encontrado.</td></tr>';return;}I['sort']((e,M)=>M['id']-e['id'])['forEach'](e=>{const M=document['createElement']('tr'),L=e['status']==='Ativo'?'active':e['status']==='Negociacao'?'lead':'pending';M['innerHTML']='<td><strong>'+e['name']+'</strong><br><small\x20style=\x22color:#64748b\x22>'+(e['email']||'')+'</small></td><td>'+e['type']+'</td><td>'+(e['phone']||'-')+'</td><td><span\x20class=\x22status-badge\x20'+L+'\x22>'+e['status']+'</span></td><td><button\x20class=\x22btn\x20btn-sm\x20btn-outline\x22\x20onclick=\x22contactManager.edit('+e['id']+')\x22><i\x20class=\x22fas\x20fa-edit\x22></i></button>\x20<button\x20class=\x22btn\x20btn-sm\x20btn-danger-outline\x22\x20onclick=\x22contactManager.del('+e['id']+')\x22><i\x20class=\x22fas\x20fa-trash\x22></i></button></td>',d['appendChild'](M);});},'search':()=>{const I=document['getElementById']('searchContact')['value']['toLowerCase'](),d=document['getElementById']('filterType')['value'],e=contactManager['contacts']['filter'](M=>{return(M['name']['toLowerCase']()['includes'](I)||M['phone']&&M['phone']['includes'](I))&&(d?M['type']===d:!![]);});contactManager['render'](e);},'switchTab':I=>{document['querySelectorAll']('.modal-tab-btn')['forEach'](d=>d['classList']['remove']('active')),event['currentTarget']['classList']['add']('active'),document['querySelectorAll']('.inner-tab')['forEach'](d=>d['classList']['remove']('active')),document['getElementById']('modal-tab-'+I)['classList']['add']('active');},'openModal':(I=![])=>{document['getElementById']('contact-modal')['style']['display']='flex',document['getElementById']('header-name')['innerText']='Novo\x20Contato',document['getElementById']('header-id')['innerText']='ID:\x20#NOVO',document['getElementById']('header-avatar')['innerHTML']='<i\x20class=\x22fas\x20fa-user\x22></i>',document['querySelectorAll']('.modal-tab-btn')['forEach'](d=>d['classList']['remove']('active')),document['querySelectorAll']('.inner-tab')['forEach'](d=>d['classList']['remove']('active')),document['querySelector']('.modal-tab-btn')['classList']['add']('active'),document['getElementById']('modal-tab-basic')['classList']['add']('active'),!I&&(document['getElementById']('contact-form')['reset'](),document['getElementById']('c-id')['value']='',document['getElementById']('c-timeline-display')['innerHTML']='<p\x20style=\x22color:#94a3b8;\x20font-size:0.85rem;\x22>Salve\x20o\x20contato\x20para\x20iniciar\x20o\x20histórico.</p>',document['getElementById']('timeline-controls')['style']['display']='none');},'closeModal':()=>{document['getElementById']('contact-modal')['style']['display']='none';},'save':async I=>{I['preventDefault']();const d=document['getElementById']('c-id')['value'];let M={};if(d)M=contactManager['contacts']['find'](b=>b['id']==d)||{};const L={'id':d?parseInt(d):Date['now'](),'name':document['getElementById']('c-name')['value'],'cpf':document['getElementById']('c-cpf')['value'],'job':document['getElementById']('c-job')['value'],'type':document['getElementById']('c-type')['value'],'status':document['getElementById']('c-status')['value'],'phone':document['getElementById']('c-phone')['value'],'email':document['getElementById']('c-email')['value'],'cep':document['getElementById']('c-cep')['value'],'city':document['getElementById']('c-city')['value'],'address':document['getElementById']('c-address')['value'],'number':document['getElementById']('c-number')['value'],'district':document['getElementById']('c-district')['value'],'complement':document['getElementById']('c-complement')['value'],'insta':document['getElementById']('c-insta')['value'],'social2':document['getElementById']('c-social2')['value'],'birth':document['getElementById']('c-birth')['value'],'source':document['getElementById']('c-source')['value'],'notes':document['getElementById']('c-notes')['value'],'timeline':M['timeline']||[]};if(!d)L['timeline']['push']({'date':new Date(),'type':'note','text':'Cadastro\x20criado\x20no\x20sistema.'});await db['put']('contacts',L),contactManager['closeModal'](),contactManager['load']();},'edit':I=>{const d=contactManager['contacts']['find'](e=>e['id']===I);d&&(contactManager['openModal'](!![]),document['getElementById']('header-name')['innerText']=d['name'],document['getElementById']('header-id')['innerText']='ID:\x20#'+d['id'],document['getElementById']('c-id')['value']=d['id'],document['getElementById']('c-name')['value']=d['name'],document['getElementById']('c-cpf')['value']=d['cpf']||'',document['getElementById']('c-job')['value']=d['job']||'',document['getElementById']('c-type')['value']=d['type'],document['getElementById']('c-status')['value']=d['status'],document['getElementById']('c-phone')['value']=d['phone'],document['getElementById']('c-email')['value']=d['email'],document['getElementById']('c-cep')['value']=d['cep']||'',document['getElementById']('c-city')['value']=d['city']||'',document['getElementById']('c-address')['value']=d['address']||'',document['getElementById']('c-number')['value']=d['number']||'',document['getElementById']('c-district')['value']=d['district']||'',document['getElementById']('c-complement')['value']=d['complement']||'',document['getElementById']('c-insta')['value']=d['insta']||'',document['getElementById']('c-social2')['value']=d['social2']||'',document['getElementById']('c-birth')['value']=d['birth']||'',document['getElementById']('c-source')['value']=d['source']||'Outro',document['getElementById']('c-notes')['value']=d['notes']||'',document['getElementById']('timeline-controls')['style']['display']='block',contactManager['renderTimeline'](d['timeline']||[]));},'renderTimeline':I=>{const d=document['getElementById']('c-timeline-display');d['innerHTML']='';if(!I||I['length']===0x0){d['innerHTML']='<p\x20style=\x22color:#94a3b8;\x20font-size:0.85rem;\x22>Nenhuma\x20interação\x20registrada\x20ainda.</p>';return;}const e={'call':'fa-phone','whatsapp':'fab\x20fa-whatsapp','meeting':'fa-handshake','email':'fa-envelope','note':'fa-sticky-note'},M={'call':'t-call','whatsapp':'t-whatsapp','meeting':'t-meeting','email':'t-email','note':'t-note'};[...I]['sort']((L,v)=>new Date(v['date'])-new Date(L['date']))['forEach'](L=>{const b=e[L['type']]||e['note'],v=M[L['type']]||M['note'],B=new Date(L['date'])['toLocaleDateString']();d['innerHTML']+='<div\x20class=\x22timeline-item\x22><div\x20class=\x22timeline-icon\x20'+v+'\x22><i\x20class=\x22'+b+'\x22></i></div><div\x20class=\x22timeline-header\x22><span\x20class=\x22timeline-type\x22>'+(L['type']||'Nota')+'</span><span\x20class=\x22timeline-date\x22>'+B+'</span></div><div\x20class=\x22timeline-content\x22>'+L['text']+'</div></div>';});},'addTimeline':async()=>{const I=document['getElementById']('new-note')['value'],d=document['getElementById']('note-type')['value'],e=parseInt(document['getElementById']('c-id')['value']);if(I&&e){const M=contactManager['contacts']['find'](L=>L['id']===e);if(!M['timeline'])M['timeline']=[];M['timeline']['push']({'date':new Date(),'type':d,'text':I}),await db['put']('contacts',M),document['getElementById']('new-note')['value']='',contactManager['renderTimeline'](M['timeline']),contactManager['load']();}},'del':async I=>{confirm('Tem\x20certeza?')&&(await db['delete']('contacts',I),contactManager['load']());}},albumManager={'albums':[],'types':[],'init':async()=>{const I=localStorage['getItem']('projectTypes');I?albumManager['types']=JSON['parse'](I):(albumManager['types']=[{'id':0x1,'name':'Álbum\x20de\x20Casamento','stages':['Seleção','Edição','Diagramação','Aprovação','Impressão','Entregue']},{'id':0x2,'name':'Ensaio\x20Fotográfico','stages':['Agendado','Realizado','Edição','Galeria\x20Online','Finalizado']}],localStorage['setItem']('projectTypes',JSON['stringify'](albumManager['types'])));},'load':async()=>{await albumManager['init'](),albumManager['albums']=await db['getAll']('albums');const I=document['getElementById']('albums-container');I['innerHTML']='';if(albumManager['albums']['length']===0x0){I['innerHTML']='<p\x20style=\x22text-align:center;\x20color:#64748b;\x20grid-column:\x201/-1;\x20padding:\x2040px;\x22>Nenhum\x20projeto\x20em\x20andamento.\x20Inicie\x20um\x20novo\x20clicando\x20no\x20botão\x20acima.</p>';return;}albumManager['albums']['forEach'](d=>{const e=albumManager['types']['find'](N=>N['id']==d['typeId']),M=e?e['stages']:d['stages']||['Início','Fim'],L=parseInt(d['currentStageIdx']||0x0),b=M['length'],v=Math['min'](Math['round']((L+0x1)/b*0x64),0x64),B=L>=b-0x1,T='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22project-card-premium\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pcp-stripe\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pcp-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pcp-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4>'+d['name']+'</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pcp-client\x22><i\x20class=\x22fas\x20fa-user-circle\x22></i>\x20'+d['clientName']+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pcp-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pcp-btn-action\x22\x20onclick=\x22albumManager.edit(\x27'+d['id']+'\x27)\x22\x20title=\x22Editar\x22><i\x20class=\x22fas\x20fa-pencil-alt\x22></i></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pcp-btn-action\x20delete\x22\x20onclick=\x22albumManager.delete(\x27'+d['id']+'\x27)\x22\x20title=\x22Excluir\x22><i\x20class=\x22fas\x20fa-trash-alt\x22></i></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pcp-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pcp-stage-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22pcp-stage-label\x22>Etapa\x20Atual</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22pcp-stage-current\x22>'+M[L]+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pcp-progress-track\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pcp-progress-fill\x22\x20style=\x22width:\x20'+v+'%\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pcp-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pcp-date\x22><i\x20class=\x22far\x20fa-clock\x22></i>\x20ID:\x20#'+d['id']+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(B?'<span\x20class=\x22status-badge\x20active\x22><i\x20class=\x22fas\x20fa-check\x22></i>\x20Concluído</span>':'<button\x20class=\x22pcp-btn-advance\x22\x20onclick=\x22albumManager.nextStage(\x27'+d['id']+'\x27)\x22>Avançar\x20<i\x20class=\x22fas\x20fa-chevron-right\x22></i></button>')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';I['insertAdjacentHTML']('beforeend',T);});},'openConfig':()=>{document['getElementById']('album-modal')['style']['display']='flex',document['getElementById']('alb-modal-subtitle')['innerText']='Configuração\x20de\x20Tipos\x20e\x20Workflows',document['getElementById']('alb-view-config')['style']['display']='block',document['getElementById']('alb-view-project')['style']['display']='none',albumManager['renderTypesList']();},'openModal':async(I=null)=>{document['getElementById']('album-modal')['style']['display']='flex',document['getElementById']('alb-modal-subtitle')['innerText']=I?'Editar\x20Projeto':'Novo\x20Projeto',document['getElementById']('alb-view-config')['style']['display']='none',document['getElementById']('alb-view-project')['style']['display']='block',document['getElementById']('album-form')['reset']();const d=await db['getAll']('contacts'),e=document['getElementById']('alb-client-select');e['innerHTML']='<option\x20value=\x22\x22>Selecione\x20o\x20Cliente...</option>',d['forEach'](L=>e['innerHTML']+='<option\x20value=\x22'+L['name']+'\x22>'+L['name']+'</option>');const M=document['getElementById']('alb-type-select');M['innerHTML']='',albumManager['types']['forEach'](L=>M['innerHTML']+='<option\x20value=\x22'+L['id']+'\x22>'+L['name']+'</option>');if(I){const L=albumManager['albums']['find'](b=>b['id']==I);document['getElementById']('alb-id')['value']=L['id'],document['getElementById']('alb-name')['value']=L['name'],document['getElementById']('alb-client-select')['value']=L['clientName'],document['getElementById']('alb-type-select')['value']=L['typeId'],albumManager['renderProjectTimelinePreview'](L['typeId'],L['currentStageIdx']);}else document['getElementById']('alb-id')['value']='',albumManager['updateStagesPreview']();},'renderTypesList':()=>{const I=document['getElementById']('alb-types-list');I['innerHTML']='',albumManager['types']['forEach'](d=>{const e=document['createElement']('div');e['className']='type-card',e['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22type-icon\x22><i\x20class=\x22fas\x20fa-stream\x22></i></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22type-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4>'+d['name']+'</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+d['stages']['length']+'\x20etapas\x20definidas</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',e['onclick']=()=>albumManager['selectTypeConfig'](d['id'],e),I['appendChild'](e);});},'newType':()=>{const I=prompt('Nome\x20do\x20novo\x20tipo\x20de\x20projeto:');if(!I)return;const d=Date['now']();albumManager['types']['push']({'id':d,'name':I,'stages':['Início','Conclusão']}),localStorage['setItem']('projectTypes',JSON['stringify'](albumManager['types'])),albumManager['renderTypesList']();},'selectTypeConfig':(I,d)=>{document['querySelectorAll']('.type-card')['forEach'](b=>b['classList']['remove']('selected')),d['classList']['add']('selected');const e=albumManager['types']['find'](b=>b['id']==I),M=document['getElementById']('alb-config-content');let L='';e['stages']['forEach']((b,v)=>{L+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<li\x20class=\x22step-item-edit\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22step-num-badge\x22>'+(v+0x1)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22step-content-edit\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20value=\x22'+b+'\x22\x20onchange=\x22albumManager.updateStageName('+I+',\x20'+v+',\x20this.value)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-sm\x20btn-danger-outline\x22\x20onclick=\x22albumManager.removeStage('+I+',\x20'+v+')\x22><i\x20class=\x22fas\x20fa-times\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</li>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}),M['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22padding:20px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:flex;\x20justify-content:space-between;\x20margin-bottom:20px;\x20border-bottom:1px\x20solid\x20#e2e8f0;\x20padding-bottom:10px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>'+e['name']+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-sm\x20btn-danger-outline\x22\x20onclick=\x22albumManager.deleteType('+I+')\x22>Excluir\x20Tipo</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-bottom:15px;\x20font-size:0.9rem;\x20color:#64748b;\x22>Etapas\x20do\x20Workflow</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<ul\x20class=\x22step-list-editable\x22\x20id=\x22stage-list-ul\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+L+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</ul>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-outline\x20btn-sm\x22\x20style=\x22margin-top:15px;\x20width:100%;\x22\x20onclick=\x22albumManager.addStage('+I+')\x22>+\x20Adicionar\x20Etapa</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';},'updateStageName':(I,d,e)=>{const M=albumManager['types']['find'](L=>L['id']==I);M['stages'][d]=e,localStorage['setItem']('projectTypes',JSON['stringify'](albumManager['types']));},'addStage':I=>{const d=albumManager['types']['find'](M=>M['id']==I);d['stages']['push']('Nova\x20Etapa'),localStorage['setItem']('projectTypes',JSON['stringify'](albumManager['types']));const e=document['querySelector']('.type-card.selected');if(e)albumManager['selectTypeConfig'](I,e);},'removeStage':(I,d)=>{const e=albumManager['types']['find'](L=>L['id']==I);if(e['stages']['length']<=0x1)return alert('O\x20workflow\x20deve\x20ter\x20pelo\x20menos\x201\x20etapa.');e['stages']['splice'](d,0x1),localStorage['setItem']('projectTypes',JSON['stringify'](albumManager['types']));const M=document['querySelector']('.type-card.selected');if(M)albumManager['selectTypeConfig'](I,M);},'deleteType':I=>{confirm('Excluir\x20este\x20tipo\x20de\x20projeto?')&&(albumManager['types']=albumManager['types']['filter'](d=>d['id']!=I),localStorage['setItem']('projectTypes',JSON['stringify'](albumManager['types'])),albumManager['renderTypesList'](),document['getElementById']('alb-config-content')['innerHTML']='');},'updateStagesPreview':()=>{const I=document['getElementById']('alb-type-select')['value'];albumManager['renderProjectTimelinePreview'](I,0x0);},'renderProjectTimelinePreview':(I,d)=>{const e=albumManager['types']['find'](L=>L['id']==I),M=document['getElementById']('alb-timeline-preview');M['innerHTML']='';if(!e)return;e['stages']['forEach']((L,b)=>{const v=b<d,B=b===parseInt(d);let T='';if(v)T='completed';if(B)T='active';M['innerHTML']+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22prj-event\x20'+T+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22prj-dot\x22>'+(b+0x1)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22prj-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22prj-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4>'+L+'</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+(B?'Etapa\x20Atual':v?'Concluído':'Aguardando')+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(B?'<button\x20type=\x22button\x22\x20class=\x22prj-action-btn\x22\x20onclick=\x22albumManager.setStageManually('+b+')\x22>Atual</button>':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(!B&&!v?'<button\x20type=\x22button\x22\x20class=\x22btn-clean\x22\x20onclick=\x22albumManager.setStageManually('+b+')\x22><i\x20class=\x22fas\x20fa-check\x22></i>\x20Definir\x20aqui</button>':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';});},'setStageManually':I=>{const d=document['getElementById']('alb-type-select')['value'];albumManager['tempStageIdx']=I,albumManager['renderProjectTimelinePreview'](d,I);},'saveMainForm':async()=>{if(document['getElementById']('alb-view-config')['style']['display']==='block'){document['getElementById']('album-modal')['style']['display']='none';return;}const I=document['getElementById']('alb-id')['value'],d=document['getElementById']('alb-type-select')['value'],e=albumManager['tempStageIdx']!==undefined?albumManager['tempStageIdx']:0x0;let M=e;if(I&&albumManager['tempStageIdx']===undefined){const b=albumManager['albums']['find'](v=>v['id']==I);if(b)M=b['currentStageIdx'];}const L={'id':I?I:Date['now']()['toString'](),'name':document['getElementById']('alb-name')['value'],'clientName':document['getElementById']('alb-client-select')['value'],'typeId':d,'currentStageIdx':M,'stages':albumManager['types']['find'](v=>v['id']==d)['stages']};await db['put']('albums',L),albumManager['tempStageIdx']=undefined,document['getElementById']('album-modal')['style']['display']='none',albumManager['load']();},'edit':I=>{albumManager['openModal'](I);},'delete':async I=>{confirm('Deseja\x20realmente\x20excluir\x20este\x20projeto?')&&(await db['delete']('albums',I),albumManager['load']());},'nextStage':async I=>{const d=albumManager['albums']['find'](L=>L['id']==I),e=albumManager['types']['find'](L=>L['id']==d['typeId']),M=e?e['stages']:d['stages'];d['currentStageIdx']<M['length']-0x1?(d['currentStageIdx']++,await db['put']('albums',d),albumManager['load']()):alert('Projeto\x20já\x20concluído!');}},app={'initialized':![],async 'init'(){this['initClock'](),await db['connect'](),globalConfig['load'](),contactManager['load'](),await albumManager['init'](),albumManager['load'](),await agendaManager['init'](),calendarManager['init'](),oppManager['load'](),stockManager['load'](),msgManager['init'](),dashboardManager['init'](),this['initialized']=!![];},'initClock'(){setInterval(()=>{const I=new Date();document['getElementById']('clock')['innerText']=I['toLocaleTimeString']([],{'hour':'2-digit','minute':'2-digit'}),document['getElementById']('date-display')['innerText']=I['toLocaleDateString']('pt-BR',{'weekday':'long','year':'numeric','month':'long','day':'numeric'});},0x3e8);},'nav'(I){document['querySelectorAll']('.tab-content')['forEach'](d=>d['classList']['remove']('active')),document['querySelectorAll']('nav\x20button')['forEach'](d=>d['classList']['remove']('active')),document['getElementById']('tab-'+I)['classList']['add']('active'),event['currentTarget']['classList']['add']('active');switch(I){case'contacts':contactManager['load']();break;case'management':albumManager['load']();break;case'agenda':agendaManager['render']();break;case'home':calendarManager['render'](),dashboardManager['applySettings']();break;}}},globalConfig={'defaults':{'primary':'#2563eb','secondary':'#22c55e','font':'16','theme':'light'},'load'(){const I=JSON['parse'](localStorage['getItem']('rc_global_config'))||this['defaults'];document['documentElement']['style']['setProperty']('--primary-color',I['primary']),document['documentElement']['style']['setProperty']('--secondary-color',I['secondary']),document['documentElement']['style']['fontSize']=I['font']+'px',I['theme']==='dark'?document['documentElement']['classList']['add']('dark'):document['documentElement']['classList']['remove']('dark'),document['getElementById']('cfg-primary')['value']=I['primary'],document['getElementById']('cfg-secondary')['value']=I['secondary'],document['getElementById']('cfg-font')['value']=I['font'],document['getElementById']('cfg-theme')['value']=I['theme'];},'save'(){const I={'primary':document['getElementById']('cfg-primary')['value'],'secondary':document['getElementById']('cfg-secondary')['value'],'font':document['getElementById']('cfg-font')['value'],'theme':document['getElementById']('cfg-theme')['value']};localStorage['setItem']('rc_global_config',JSON['stringify'](I)),this['load'](),alert('✔️\x20Configurações\x20globais\x20salvas\x20com\x20sucesso!');}};function toggleMobileMenu(){const I=document['querySelector']('aside'),d=document['getElementById']('mobile-overlay'),e=document['getElementById']('mobile-menu-trigger'),M=I['classList']['contains']('open');M?(I['classList']['remove']('open'),d['style']['display']='none',document['body']['style']['overflow']='',e['style']['transform']='rotate(0deg)'):(I['classList']['add']('open'),d['style']['display']='block',document['body']['style']['overflow']='hidden',e['style']['transform']='rotate(90deg)');}function showSection(I){document['querySelectorAll']('.tab-item')['forEach'](d=>d['classList']['remove']('active')),event['currentTarget']['classList']['add']('active');}window['addEventListener']('resize',()=>{if(window['innerWidth']>0x300){const I=document['querySelector']('aside');if(I)I['classList']['remove']('open');const d=document['getElementById']('mobile-overlay');if(d)d['style']['display']='none';document['body']['style']['overflow']='';}}),(function(){const I='lg_crm_supadb',d='lg_crmDB';let e=sessionStorage['getItem']('sync_device_id');!e&&(e=crypto['randomUUID'](),sessionStorage['setItem']('sync_device_id',e));const M=e;let L=![],b=null;const v=new Map(),B=()=>window['supabaseClient']||window['supabase'],T=()=>new Promise(G=>{const Q=()=>B()?G(B()):setTimeout(Q,0x64);Q();});async function N(){const G=await T(),{data:Q}=await G['auth']['getSession']();return Q?.['session']?.['user']?.['id']||null;}function z(G){if(G===null||G===undefined)return'null';return JSON['stringify'](G);}const P={'put':IDBObjectStore['prototype']['put'],'add':IDBObjectStore['prototype']['add'],'delete':IDBObjectStore['prototype']['delete']};async function U(G,Q,R,l){if(L)return;const x=B(),a=await N();if(!x||!a)return;const y=G+'-'+R;Q==='delete'?v['delete'](y):v['set'](y,z(l)),x['from'](I)['upsert']({'user_id':a,'db_name':d,'store_name':G,'record_key':String(R),'record_value':Q==='delete'?null:l,'is_deleted':Q==='delete','device_id':M,'updated_at':new Date()['toISOString']()},{'onConflict':'user_id,db_name,store_name,record_key'})['then'](({error:Z})=>{if(Z)console['warn']('⚠️\x20Sync\x20Upload\x20Falhou:',Z['message']);});}IDBObjectStore['prototype']['put']=function(G,Q){const R=P['put']['apply'](this,arguments),l=this['name'];return R['onsuccess']=x=>U(l,'put',Q||x['target']['result'],G),R;},IDBObjectStore['prototype']['add']=function(G,Q){const R=P['add']['apply'](this,arguments),l=this['name'];return R['onsuccess']=x=>U(l,'add',Q||x['target']['result'],G),R;},IDBObjectStore['prototype']['delete']=function(G){const Q=P['delete']['apply'](this,arguments),R=this['name'];return Q['onsuccess']=l=>U(R,'delete',G,null),Q;},console['log']('\x20.)');async function k(){const G=await N(),Q=B();if(!G||!Q)return;const R=indexedDB['open'](d);R['onsuccess']=l=>{const x=l['target']['result'],a=Array['from'](x['objectStoreNames']);a['forEach'](y=>{const Z=x['transaction']([y],'readonly'),D=Z['objectStore'](y);Promise['all']([new Promise(h=>D['getAll']()['onsuccess']=m=>h(m['target']['result'])),new Promise(h=>D['getAllKeys']()['onsuccess']=m=>h(m['target']['result']))])['then'](async([h,m])=>{if(!h['length'])return;const o=[];h['forEach']((s,j)=>{const A=String(m[j]),r=y+'-'+A,p=z(s);v['get'](r)!==p&&(o['push']({'user_id':G,'db_name':d,'store_name':y,'record_key':A,'record_value':s,'is_deleted':![],'device_id':M,'updated_at':new Date()['toISOString']()}),v['set'](r,p));}),o['length']>0x0&&(console['log']('.:\x20'+o['length']+'\x20itens'),await Q['from'](I)['upsert'](o,{'onConflict':'user_id,db_name,store_name,record_key'}));});});};}async function W(){const G=await N(),Q=B();if(!G||!Q)return;const {data:R,error:l}=await Q['from'](I)['select']('*')['eq']('user_id',G)['eq']('db_name',d);if(l||!R||!R['length'])return;const x=indexedDB['open'](d);x['onsuccess']=a=>{const y=a['target']['result'],Z=Array['from'](y['objectStoreNames']),D=R['filter'](o=>Z['includes'](o['store_name']));if(!D['length'])return;const h=y['transaction']([...new Set(D['map'](o=>o['store_name']))],'readwrite');L=!![];let m=0x0;D['forEach'](o=>{if(o['device_id']===M)return;const s=h['objectStore'](o['store_name']),j=!isNaN(o['record_key'])?Number(o['record_key']):o['record_key'],A=o['store_name']+'-'+o['record_key'];if(o['is_deleted']){s['delete'](j);v['has'](A)&&(v['delete'](A),m++);return;}const p=z(o['record_value']),H=v['get'](A);if(p===H)return;const K=o['record_value'];if(s['keyPath']&&K&&typeof K==='object'){if(!K[s['keyPath']])K[s['keyPath']]=j;s['put'](K);}else s['put'](K,j);v['set'](A,p),m++;}),h['oncomplete']=()=>{L=![];if(m>0x0)console['log']('📥\x20Download\x20Sync:\x20'+m+'\x20alterações\x20aplicadas.');},h['onerror']=()=>L=![];};}async function V(){const G=await N();if(!G)return;console['log']('.\x20',G);const Q=B();Q['channel']('global-sync-live')['on']('postgres_changes',{'event':'*','schema':'public','table':I,'filter':'user_id=eq.'+G},R=>{R['new']&&R['new']['device_id']!==M&&W();})['subscribe'](),await k(),setTimeout(W,0x1f4);if(b)clearInterval(b);b=setInterval(async()=>{await k(),await W();},0x2710);}T()['then'](G=>{G['auth']['onAuthStateChange']((Q,R)=>{if(Q==='SIGNED_IN'&&R)V();}),N()['then'](Q=>{if(Q)V();});});}());
</script>

</body>
</html>
